"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.RemoteDebugger = exports.default = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _rpc = require("./rpc");

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _uuidJs = _interopRequireDefault(require("uuid-js"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

let VERSION;

try {
  VERSION = require(_path.default.resolve(__dirname, '..', '..', 'package.json')).version;
} catch (ign) {}

const APP_CONNECT_TIMEOUT_MS = 0;
const APP_CONNECT_INTERVAL_MS = 100;
const SELECT_APP_RETRIES = 20;
const SELECT_APP_RETRY_SLEEP_MS = 500;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
const BLANK_PAGE_URL = 'about:blank';
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const GARBAGE_COLLECT_TIMEOUT = 5000;
const ACTIVE_APP_CODE = 0;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();

    if (VERSION) {
      _logger.default.info(`Remote Debugger version ${VERSION}`);
    }

    const {
      bundleId,
      additionalBundleIds = [],
      platformVersion,
      isSafari = true,
      includeSafari = false,
      useNewSafari = false,
      pageLoadMs,
      host,
      port = REMOTE_DEBUGGER_PORT,
      socketPath,
      pageReadyTimeout = PAGE_READY_TIMEOUT,
      remoteDebugProxy,
      garbageCollectOnExecute = false,
      logFullResponse = false,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      socketChunkSize,
      fullPageInitialization
    } = opts;
    this.bundleId = bundleId;
    this.additionalBundleIds = additionalBundleIds;
    this.platformVersion = platformVersion;
    this.isSafari = isSafari;
    this.includeSafari = includeSafari;
    this.useNewSafari = useNewSafari;
    this.pageLoadMs = pageLoadMs;

    _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
    this.logAllCommunication = _lodash.default.isNil(logAllCommunication) ? !!logFullResponse : !!logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.fullPageInitialization = fullPageInitialization;
    this.skippedApps = [];
    this._lock = new _asyncLock.default();
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this._navigatingToPage = false;
    this.allowNavigationWithoutReload = false;
    this.rpcClient = null;
    this._clientEventListeners = {};
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  initRpcClient() {
    this.rpcClient = new _rpc.RpcClientSimulator({
      bundleId: this.bundleId,
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      messageProxy: this.remoteDebugProxy,
      logAllCommunication: this.logAllCommunication,
      logAllCommunicationHexDump: this.logAllCommunicationHexDump,
      fullPageInitialization: this.fullPageInitialization
    });
  }

  async connect(timeout = APP_CONNECT_TIMEOUT_MS) {
    this.setup();
    this.initRpcClient();
    this.rpcClient.on('_rpc_reportSetup:', _lodash.default.noop);
    this.rpcClient.on('_rpc_forwardGetListing:', this.onPageChange.bind(this));
    this.rpcClient.on('_rpc_reportConnectedApplicationList:', this.onConnectedApplicationList.bind(this));
    this.rpcClient.on('_rpc_applicationConnected:', this.onAppConnect.bind(this));
    this.rpcClient.on('_rpc_applicationDisconnected:', this.onAppDisconnect.bind(this));
    this.rpcClient.on('_rpc_applicationUpdated:', this.onAppUpdate.bind(this));
    this.rpcClient.on('_rpc_reportConnectedDriverList:', this.onConnectedDriverList.bind(this));
    this.rpcClient.on('pageLoad', this.pageLoad.bind(this));
    this.rpcClient.on('Page.frameDetached', this.frameDetached.bind(this));
    await this.rpcClient.connect();

    try {
      await this.setConnectionKey();

      if (timeout) {
        _logger.default.debug(`Waiting up to ${timeout}ms for applications to be reported`);

        try {
          await (0, _asyncbox.waitForCondition)(() => {
            return !_lodash.default.isEmpty(this.appDict);
          }, {
            waitMs: timeout,
            interval: APP_CONNECT_INTERVAL_MS
          });
        } catch (err) {
          _logger.default.debug(`Timed out waiting for applications to be reported`);
        }
      }

      return this.appDict || {};
    } catch (err) {
      _logger.default.error(`Error setting connection key: ${err.message}`);

      await this.disconnect();
      throw err;
    }
  }

  async disconnect() {
    if (this.rpcClient) {
      await this.rpcClient.disconnect();
    }

    this.emit(RemoteDebugger.EVENT_DISCONNECT, true);
    this.teardown();
  }

  get isConnected() {
    var _this$rpcClient;

    return !!((_this$rpcClient = this.rpcClient) === null || _this$rpcClient === void 0 ? void 0 : _this$rpcClient.isConnected);
  }

  async setConnectionKey() {
    _logger.default.debug('Sending connection key request');

    await this.rpcClient.send('setConnectionKey', {}, false);
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};
    let [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.appDict[id]) {
      entry.pageArray = this.appDict[id].pageArray;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageArray)) {
      entry.pageArray = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.appDict);
    }
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageArray' && !_lodash.default.isArray(value)) {
        return `'Waiting for data'`;
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    for (const [app, info] of _lodash.default.toPairs(apps)) {
      _logger.default.debug(`    Application: '${app}'`);

      for (const [key, value] of _lodash.default.toPairs(info)) {
        if (key === 'pageArray' && Array.isArray(value) && value.length) {
          _logger.default.debug(`        ${key}:`);

          for (const page of value) {
            let prefix = '- ';

            for (const [k, v] of _lodash.default.toPairs(page)) {
              _logger.default.debug(`          ${prefix}${k}: ${JSON.stringify(v)}`);

              prefix = '  ';
            }
          }
        } else {
          const valueString = getValueString(key, value);

          _logger.default.debug(`        ${key}: ${valueString}`);
        }
      }
    }
  }

  async selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    const shouldCheckForTarget = this.rpcClient.shouldCheckForTarget;
    this.rpcClient.shouldCheckForTarget = false;

    try {
      const timer = new _appiumSupport.timing.Timer().start();

      _logger.default.debug('Selecting application');

      if (!this.appDict || _lodash.default.isEmpty(this.appDict)) {
        _logger.default.debug('No applications currently connected.');

        return [];
      }

      const {
        appIdKey,
        pageDict
      } = await this.searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl);

      if (!appIdKey || !pageDict) {
        _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
      }

      if (this.appIdKey !== appIdKey) {
        _logger.default.debug(`Received altered app id, updating from '${this.appIdKey}' to '${appIdKey}'`);

        this.appIdKey = appIdKey;
      }

      this.logApplicationDictionary(this.appDict);
      const pageArray = _lodash.default.isEmpty(this.appDict[appIdKey].pageArray) ? (0, _helpers.pageArrayFromDict)(pageDict) : this.appDict[appIdKey].pageArray;

      _logger.default.debug(`Finally selecting app ${this.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

      let fullPageArray = [];

      for (const [app, info] of _lodash.default.toPairs(this.appDict)) {
        if (!_lodash.default.isArray(info.pageArray) || info.isActive === ACTIVE_APP_CODE) {
          continue;
        }

        const id = app.replace('PID:', '');

        for (const page of info.pageArray) {
          if (!(ignoreAboutBlankUrl && page.url === BLANK_PAGE_URL)) {
            let pageDict = _lodash.default.clone(page);

            pageDict.id = `${id}.${pageDict.id}`;
            pageDict.bundleId = info.bundleId;
            fullPageArray.push(pageDict);
          }
        }
      }

      _logger.default.debug(`Selected app after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);

      return fullPageArray;
    } finally {
      this.rpcClient.shouldCheckForTarget = shouldCheckForTarget;
    }
  }

  async searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl) {
    const bundleIds = this.includeSafari && !this.isSafari ? [this.bundleId, ...this.additionalBundleIds, SAFARI_BUNDLE_ID] : [this.bundleId, ...this.additionalBundleIds];

    try {
      return await (0, _asyncbox.retryInterval)(maxTries, SELECT_APP_RETRY_SLEEP_MS, async retryCount => {
        this.logApplicationDictionary(this.appDict);
        const possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(bundleIds, this.appDict);

        _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')} (try #${retryCount + 1} of ${maxTries})`);

        for (const attemptedAppIdKey of possibleAppIds) {
          try {
            if (this.appDict[attemptedAppIdKey].isActive === ACTIVE_APP_CODE) {
              _logger.default.debug(`Skipping app '${attemptedAppIdKey}' because it is not active`);

              continue;
            }

            _logger.default.debug(`Attempting app '${attemptedAppIdKey}'`);

            const [appIdKey, pageDict] = await this.rpcClient.selectApp(attemptedAppIdKey, this.onAppConnect.bind(this));

            if (_lodash.default.isEmpty(pageDict)) {
              _logger.default.debug('Empty page dictionary received. Trying again.');

              continue;
            }

            this.appDict[appIdKey].pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
            const result = this.searchForPage(this.appDict, currentUrl, ignoreAboutBlankUrl);

            if (result) {
              return result;
            }

            if (currentUrl) {
              _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
            } else {
              _logger.default.debug('Received app, but no match was found. Trying again.');
            }
          } catch (err) {
            _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
          }
        }

        retryCount++;
        throw new Error('Failed to find an app to select');
      }, 0);
    } catch (ign) {
      _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
    }
  }

  searchForPage(appsDict, currentUrl = null, ignoreAboutBlankUrl = false) {
    for (const appDict of _lodash.default.values(appsDict)) {
      if (!appDict || appDict.isActive === ACTIVE_APP_CODE || !appDict.pageArray || appDict.pageArray.promise) {
        continue;
      }

      for (const dict of appDict.pageArray) {
        if ((!ignoreAboutBlankUrl || dict.url !== BLANK_PAGE_URL) && (!currentUrl || dict.url === currentUrl || dict.url === `${currentUrl}/`)) {
          return {
            appIdKey: appDict.id,
            pageDict: dict
          };
        }
      }
    }

    return null;
  }

  async selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    this.appIdKey = `PID:${appIdKey}`;
    this.pageIdKey = pageIdKey;

    _logger.default.debug(`Selecting page '${pageIdKey}' on app '${this.appIdKey}' and forwarding socket setup`);

    const timer = new _appiumSupport.timing.Timer().start();
    await this.rpcClient.selectPage(this.appIdKey, pageIdKey);

    if (!skipReadyCheck && !(await this.checkPageIsReady())) {
      await this.pageUnload();
    }

    _logger.default.debug(`Selected page after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
  }

  async executeAtom(atom, args, frames) {
    if (!this.rpcClient.isConnected) {
      throw new Error('Remote debugger is not connected');
    }

    _logger.default.debug(`Executing atom '${atom}'`);

    const script = await (0, _helpers.getScriptForAtom)(atom, args, frames);
    const value = await this.execute(script, true);

    _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
      length: _helpers.RESPONSE_LOG_LENGTH
    })}`);

    return value;
  }

  async executeAtomAsync(atom, args, frames) {
    const evaluate = async (method, opts) => {
      return await this.rpcClient.send(method, { ...opts,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey,
        returnByValue: false
      });
    };

    const promiseName = `appiumAsyncExecutePromise${_uuidJs.default.create().toString().replace(/-/g, '')}`;
    const script = `var res, rej;
      window.${promiseName} = new Promise(function (resolve, reject) {
        res = resolve;
        rej = reject;
      });
      window.${promiseName}.resolve = res;
      window.${promiseName}.reject = rej;
      window.${promiseName};`;
    const obj = await evaluate('Runtime.evaluate', {
      command: script
    });
    const promiseObjectId = obj.result.objectId;
    const asyncCallBack = `function (res) {
        window.${promiseName}.resolve(res);
        window.${promiseName}Value = res;
      }`;
    await this.execute((await (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack)));
    let res;
    const subcommandTimeout = 1000;

    try {
      res = await evaluate('Runtime.awaitPromise', {
        promiseObjectId
      });
    } catch (err) {
      if (!err.message.includes(`'Runtime.awaitPromise' was not found`)) {
        throw err;
      }

      const retryWait = 100;
      const timeout = args.length >= 3 ? args[2] : RPC_RESPONSE_TIMEOUT_MS;
      const retries = parseInt(timeout / retryWait, 10) || 1;
      const timer = new _appiumSupport.timing.Timer().start();

      _logger.default.debug(`Waiting up to ${timeout}ms for async execute to finish`);

      res = await (0, _asyncbox.retryInterval)(retries, retryWait, async () => {
        const hasValue = await evaluate('Runtime.evaluate', {
          command: `window.hasOwnProperty('${promiseName}Value');`
        });

        if (hasValue) {
          return await evaluate('Runtime.evaluate', {
            command: `window.${promiseName}Value;`
          });
        }

        throw new _appiumBaseDriver.errors.TimeoutError(`Timed out waiting for asynchronous script ` + `result after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms'));`);
      });
    } finally {
      try {
        await this.executeAtom('execute_script', [`delete window.${promiseName};`, [null, null], subcommandTimeout], frames);
      } catch (ign) {}
    }

    return (0, _helpers.convertResult)(res);
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  async pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    let timeoutMs = 500;
    let start = startPageLoadMs || Date.now();

    _logger.default.debug('Page loaded, verifying whether ready');

    this.pageLoading = true;

    const verify = async () => {
      this.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

      try {
        await this.pageLoadDelay;
      } catch (err) {
        if (err instanceof _bluebird.default.CancellationError) {
          return;
        }
      }

      if (!this.appIdKey) {
        _logger.default.debug('Not connected to an application. Ignoring page load');

        return;
      }

      if (_lodash.default.isFunction(pageLoadVerifyHook)) {
        await pageLoadVerifyHook();
      }

      const ready = await this.checkPageIsReady();

      if (ready || this.pageLoadMs > 0 && start + this.pageLoadMs < Date.now()) {
        _logger.default.debug('Page is ready');

        this.pageLoading = false;
      } else {
        _logger.default.debug('Page was not ready, retrying');

        await verify();
      }
    };

    await verify();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  async pageUnload() {
    _logger.default.debug('Page unloading');

    await this.waitForDom();
  }

  async waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    _logger.default.debug('Waiting for dom...');

    await this.pageLoad(startPageLoadMs, pageLoadVerifyHook);
  }

  async checkPageIsReady() {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey
    });
    if (errors) throw new Error(errors);

    _logger.default.debug('Checking document readyState');

    const readyCmd = 'document.readyState;';
    let readyState = 'loading';

    try {
      readyState = await _bluebird.default.resolve(this.execute(readyCmd, true)).timeout(this.pageReadyTimeout);
    } catch (err) {
      if (!(err instanceof _bluebird.default.TimeoutError)) {
        throw err;
      }

      _logger.default.debug(`Page readiness check timed out after ${this.pageReadyTimeout}ms`);

      return false;
    }

    _logger.default.debug(`Document readyState is '${readyState}'`);

    return readyState === 'complete';
  }

  async launchSafari() {
    await this.rpcClient.send('launchApplication', {
      bundleId: SAFARI_BUNDLE_ID
    });
  }

  async navToUrl(url, pageLoadVerifyHook) {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    this._navigatingToPage = true;

    try {
      _logger.default.debug(`Navigating to new URL: '${url}'`);

      const waitForFramePromise = this.waitForFrameNavigated();
      await this.rpcClient.send('Page.navigate', {
        url,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });

      if (!this.useNewSafari) {
        await _bluebird.default.delay(1000);
      }

      await waitForFramePromise;
      await this.waitForDom(Date.now(), pageLoadVerifyHook);
      await this.rpcClient.send('Console.enable', {
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } finally {
      this._navigatingToPage = false;
    }
  }

  async waitForFrameNavigated() {
    let navEventListener;
    return await new _bluebird.default(async resolve => {
      _logger.default.debug('Waiting for frame navigated message...');

      let startMs = Date.now();

      navEventListener = (err, value) => {
        _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000}s from: ${value}`);

        if (!this.allowNavigationWithoutReload && !this.pageLoading) {
          resolve(value);
        } else {
          _logger.default.debug('Frame navigated but we were warned about it, not ' + 'considering page state unloaded');

          this.allowNavigationWithoutReload = false;
        }

        if (this.navigationDelay) {
          this.navigationDelay.cancel();
        }
      };

      this.rpcClient.once('Page.frameNavigated', navEventListener);

      if (!this.useNewSafari || this.pageLoadMs >= 0) {
        const timeout = this.useNewSafari ? this.pageLoadMs : 500;
        this.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

        try {
          await this.navigationDelay;
          navEventListener(null, `${timeout}ms timeout`);
        } catch (err) {}
      }
    }).finally(() => {
      if (navEventListener) {
        this.rpcClient.off('Page.frameNavigated', navEventListener);
      }
    });
  }

  async startTimeline(fn) {
    _logger.default.debug('Starting to record the timeline');

    this.rpcClient.on('Timeline.eventRecorded', fn);
    return await this.rpcClient.send('startTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopTimeline() {
    _logger.default.debug('Stopping to record the timeline');

    await this.rpcClient.send('Timeline.stop', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  addClientEventListener(eventName, listener) {
    this._clientEventListeners[eventName] = this._clientEventListeners[eventName] || [];

    this._clientEventListeners[eventName].push(listener);

    this.rpcClient.on(eventName, listener);
  }

  removeClientEventListener(eventName) {
    for (const listener of this._clientEventListeners[eventName] || []) {
      this.rpcClient.off(eventName, listener);
    }
  }

  startConsole(listener) {
    _logger.default.debug('Starting to listen for JavaScript console');

    this.addClientEventListener('Console.messageAdded', listener);
    this.addClientEventListener('Console.messageRepeatCountUpdated', listener);
  }

  stopConsole() {
    _logger.default.debug('Stopping to listen for JavaScript console');

    this.removeClientEventListener('Console.messageAdded');
    this.removeClientEventListener('Console.messageRepeatCountUpdated');
  }

  startNetwork(listener) {
    _logger.default.debug('Starting to listen for network events');

    this.addClientEventListener('NetworkEvent', listener);
  }

  stopNetwork() {
    _logger.default.debug('Stopping to listen for network events');

    this.removeClientEventListener('NetworkEvent');
  }

  async execute(command, override) {
    if (this.pageLoading && !override) {
      _logger.default.debug('Trying to execute but page is not loaded.');

      await this.waitForDom();
    }

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug(`Sending javascript command: '${_lodash.default.truncate(command, {
      length: 50
    })}'`);

    const res = await this.rpcClient.send('Runtime.evaluate', {
      command,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  async callFunction(objId, fn, args) {
    let errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    if (errors) throw new Error(errors);

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug('Calling javascript function');

    const res = await this.rpcClient.send('Runtime.callFunctionOn', {
      objId,
      fn,
      args,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  set allowNavigationWithoutReload(allow) {
    this._allowNavigationWithoutReload = allow;
  }

  get allowNavigationWithoutReload() {
    return this._allowNavigationWithoutReload;
  }

  async getCookies(urls) {
    _logger.default.debug('Getting network cookies');

    return await this.rpcClient.send('Page.getCookies', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      urls
    });
  }

  async deleteCookie(cookieName, url) {
    _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

    return await this.rpcClient.send('Page.deleteCookie', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      cookieName,
      url
    });
  }

  async garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      _logger.default.debug(`Unable to collect garbage at this time`);

      return;
    }

    await _bluebird.default.resolve(this.rpcClient.send('Heap.gc', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    })).timeout(timeoutMs).then(function gcSuccess() {
      _logger.default.debug(`Garbage collection successful`);
    }).catch(function gcError(err) {
      if (err instanceof _bluebird.default.TimeoutError) {
        _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
      } else {
        _logger.default.debug(`Unable to collect garbage: ${err.message}`);
      }
    });
  }

  async useAppDictLock(fn) {
    return await this._lock.acquire('appDict', fn);
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';

for (const [name, handler] of _lodash.default.toPairs(_messageHandlers.default)) {
  RemoteDebugger.prototype[name] = handler;
}

var _default = RemoteDebugger;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiVkVSU0lPTiIsInJlcXVpcmUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInZlcnNpb24iLCJpZ24iLCJBUFBfQ09OTkVDVF9USU1FT1VUX01TIiwiQVBQX0NPTk5FQ1RfSU5URVJWQUxfTVMiLCJTRUxFQ1RfQVBQX1JFVFJJRVMiLCJTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TIiwiUkVNT1RFX0RFQlVHR0VSX1BPUlQiLCJTQUZBUklfQlVORExFX0lEIiwiQkxBTktfUEFHRV9VUkwiLCJSUENfUkVTUE9OU0VfVElNRU9VVF9NUyIsIlBBR0VfUkVBRFlfVElNRU9VVCIsIkdBUkJBR0VfQ09MTEVDVF9USU1FT1VUIiwiQUNUSVZFX0FQUF9DT0RFIiwiUmVtb3RlRGVidWdnZXIiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJsb2ciLCJpbmZvIiwiYnVuZGxlSWQiLCJhZGRpdGlvbmFsQnVuZGxlSWRzIiwicGxhdGZvcm1WZXJzaW9uIiwiaXNTYWZhcmkiLCJpbmNsdWRlU2FmYXJpIiwidXNlTmV3U2FmYXJpIiwicGFnZUxvYWRNcyIsImhvc3QiLCJwb3J0Iiwic29ja2V0UGF0aCIsInBhZ2VSZWFkeVRpbWVvdXQiLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJsb2dGdWxsUmVzcG9uc2UiLCJsb2dBbGxDb21tdW5pY2F0aW9uIiwibG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJmdWxsUGFnZUluaXRpYWxpemF0aW9uIiwiZGVidWciLCJfIiwiaXNOaWwiLCJza2lwcGVkQXBwcyIsIl9sb2NrIiwiQXN5bmNMb2NrIiwic2V0dXAiLCJhcHBEaWN0IiwiYXBwSWRLZXkiLCJwYWdlSWRLZXkiLCJwYWdlTG9hZGluZyIsIl9uYXZpZ2F0aW5nVG9QYWdlIiwiYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCIsInJwY0NsaWVudCIsIl9jbGllbnRFdmVudExpc3RlbmVycyIsInRlYXJkb3duIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJFVkVOVF9ESVNDT05ORUNUIiwiaW5pdFJwY0NsaWVudCIsIlJwY0NsaWVudFNpbXVsYXRvciIsIm1lc3NhZ2VQcm94eSIsImNvbm5lY3QiLCJ0aW1lb3V0Iiwib24iLCJub29wIiwib25QYWdlQ2hhbmdlIiwiYmluZCIsIm9uQ29ubmVjdGVkQXBwbGljYXRpb25MaXN0Iiwib25BcHBDb25uZWN0Iiwib25BcHBEaXNjb25uZWN0Iiwib25BcHBVcGRhdGUiLCJvbkNvbm5lY3RlZERyaXZlckxpc3QiLCJwYWdlTG9hZCIsImZyYW1lRGV0YWNoZWQiLCJzZXRDb25uZWN0aW9uS2V5IiwiaXNFbXB0eSIsIndhaXRNcyIsImludGVydmFsIiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwiZGlzY29ubmVjdCIsImVtaXQiLCJpc0Nvbm5lY3RlZCIsInNlbmQiLCJ1cGRhdGVBcHBzV2l0aERpY3QiLCJkaWN0IiwiaWQiLCJlbnRyeSIsInBhZ2VBcnJheSIsImlzVW5kZWZpbmVkIiwibG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IiwiYXBwcyIsImdldFZhbHVlU3RyaW5nIiwia2V5IiwidmFsdWUiLCJpc0Z1bmN0aW9uIiwiaXNBcnJheSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhcHAiLCJ0b1BhaXJzIiwiQXJyYXkiLCJsZW5ndGgiLCJwYWdlIiwicHJlZml4IiwiayIsInYiLCJ2YWx1ZVN0cmluZyIsInNlbGVjdEFwcCIsImN1cnJlbnRVcmwiLCJtYXhUcmllcyIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInBhZ2VEaWN0Iiwic2VhcmNoRm9yQXBwIiwiZXJyb3JBbmRUaHJvdyIsImZ1bGxQYWdlQXJyYXkiLCJpc0FjdGl2ZSIsInJlcGxhY2UiLCJ1cmwiLCJjbG9uZSIsInB1c2giLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwidG9GaXhlZCIsImJ1bmRsZUlkcyIsInJldHJ5Q291bnQiLCJwb3NzaWJsZUFwcElkcyIsImpvaW4iLCJhdHRlbXB0ZWRBcHBJZEtleSIsInJlc3VsdCIsInNlYXJjaEZvclBhZ2UiLCJFcnJvciIsImFwcHNEaWN0IiwidmFsdWVzIiwicHJvbWlzZSIsInNlbGVjdFBhZ2UiLCJza2lwUmVhZHlDaGVjayIsImNoZWNrUGFnZUlzUmVhZHkiLCJwYWdlVW5sb2FkIiwiZXhlY3V0ZUF0b20iLCJhdG9tIiwiYXJncyIsImZyYW1lcyIsInNjcmlwdCIsImV4ZWN1dGUiLCJ0cnVuY2F0ZSIsIlJFU1BPTlNFX0xPR19MRU5HVEgiLCJleGVjdXRlQXRvbUFzeW5jIiwiZXZhbHVhdGUiLCJtZXRob2QiLCJyZXR1cm5CeVZhbHVlIiwicHJvbWlzZU5hbWUiLCJVVUlEIiwiY3JlYXRlIiwidG9TdHJpbmciLCJvYmoiLCJjb21tYW5kIiwicHJvbWlzZU9iamVjdElkIiwib2JqZWN0SWQiLCJhc3luY0NhbGxCYWNrIiwicmVzIiwic3ViY29tbWFuZFRpbWVvdXQiLCJpbmNsdWRlcyIsInJldHJ5V2FpdCIsInJldHJpZXMiLCJwYXJzZUludCIsImhhc1ZhbHVlIiwiZXJyb3JzIiwiVGltZW91dEVycm9yIiwiRVZFTlRfRlJBTUVTX0RFVEFDSEVEIiwic3RhcnRQYWdlTG9hZE1zIiwicGFnZUxvYWRWZXJpZnlIb29rIiwidGltZW91dE1zIiwiRGF0ZSIsIm5vdyIsInZlcmlmeSIsInBhZ2VMb2FkRGVsYXkiLCJ1dGlsIiwiY2FuY2VsbGFibGVEZWxheSIsIkIiLCJDYW5jZWxsYXRpb25FcnJvciIsInJlYWR5IiwiY2FuY2VsUGFnZUxvYWQiLCJjYW5jZWwiLCJ3YWl0Rm9yRG9tIiwicmVhZHlDbWQiLCJyZWFkeVN0YXRlIiwibGF1bmNoU2FmYXJpIiwibmF2VG9VcmwiLCJ3YWl0Rm9yRnJhbWVQcm9taXNlIiwid2FpdEZvckZyYW1lTmF2aWdhdGVkIiwiZGVsYXkiLCJuYXZFdmVudExpc3RlbmVyIiwic3RhcnRNcyIsIm5hdmlnYXRpb25EZWxheSIsIm9uY2UiLCJmaW5hbGx5Iiwib2ZmIiwic3RhcnRUaW1lbGluZSIsImZuIiwic3RvcFRpbWVsaW5lIiwiYWRkQ2xpZW50RXZlbnRMaXN0ZW5lciIsImV2ZW50TmFtZSIsImxpc3RlbmVyIiwicmVtb3ZlQ2xpZW50RXZlbnRMaXN0ZW5lciIsInN0YXJ0Q29uc29sZSIsInN0b3BDb25zb2xlIiwic3RhcnROZXR3b3JrIiwic3RvcE5ldHdvcmsiLCJvdmVycmlkZSIsImdhcmJhZ2VDb2xsZWN0IiwiY2FsbEZ1bmN0aW9uIiwib2JqSWQiLCJhbGxvdyIsIl9hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkIiwiZ2V0Q29va2llcyIsInVybHMiLCJkZWxldGVDb29raWUiLCJjb29raWVOYW1lIiwidGhlbiIsImdjU3VjY2VzcyIsImNhdGNoIiwiZ2NFcnJvciIsInVzZUFwcERpY3RMb2NrIiwiYWNxdWlyZSIsIm5hbWUiLCJoYW5kbGVyIiwibWVzc2FnZUhhbmRsZXJzIiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLE9BQUo7O0FBQ0EsSUFBSTtBQUNGQSxFQUFBQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQ0MsY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLElBQTlCLEVBQW9DLGNBQXBDLENBQUQsQ0FBUCxDQUE2REMsT0FBdkU7QUFDRCxDQUZELENBRUUsT0FBT0MsR0FBUCxFQUFZLENBQUU7O0FBRWhCLE1BQU1DLHNCQUFzQixHQUFHLENBQS9CO0FBQ0EsTUFBTUMsdUJBQXVCLEdBQUcsR0FBaEM7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxFQUEzQjtBQUNBLE1BQU1D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QUM4SyxJQUFELEVBQU9DLE9BQVAsQ0FBWCxJQUE4QmhNLGdCQUFFNkQsT0FBRixDQUFVb0ksd0JBQVYsQ0FBOUIsRUFBMEQ7QUFDeEQzTixFQUFBQSxjQUFjLENBQUM0TixTQUFmLENBQXlCSCxJQUF6QixJQUFpQ0MsT0FBakM7QUFDRDs7ZUFFYzFOLGMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXZlbnRzIGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyBScGNDbGllbnRTaW11bGF0b3IgfSBmcm9tICcuL3JwYyc7XG5pbXBvcnQgbWVzc2FnZUhhbmRsZXJzIGZyb20gJy4vbWVzc2FnZS1oYW5kbGVycyc7XG5pbXBvcnQgeyBhcHBJbmZvRnJvbURpY3QsIHBhZ2VBcnJheUZyb21EaWN0LCBnZXREZWJ1Z2dlckFwcEtleSxcbiAgICAgICAgIGdldFBvc3NpYmxlRGVidWdnZXJBcHBLZXlzLCBjaGVja1BhcmFtcywgZ2V0U2NyaXB0Rm9yQXRvbSxcbiAgICAgICAgIHNpbXBsZVN0cmluZ2lmeSwgZGVmZXJyZWRQcm9taXNlLCBjb252ZXJ0UmVzdWx0LFxuICAgICAgICAgUkVTUE9OU0VfTE9HX0xFTkdUSCB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyB1dGlsLCB0aW1pbmcgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IFVVSUQgZnJvbSAndXVpZC1qcyc7XG5pbXBvcnQgQXN5bmNMb2NrIGZyb20gJ2FzeW5jLWxvY2snO1xuXG5cbmxldCBWRVJTSU9OO1xudHJ5IHtcbiAgVkVSU0lPTiA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3BhY2thZ2UuanNvbicpKS52ZXJzaW9uO1xufSBjYXRjaCAoaWduKSB7fVxuXG5jb25zdCBBUFBfQ09OTkVDVF9USU1FT1VUX01TID0gMDtcbmNvbnN0IEFQUF9DT05ORUNUX0lOVEVSVkFMX01TID0gMTAwO1xuY29uc3QgU0VMRUNUX0FQUF9SRVRSSUVTID0gMjA7XG5jb25zdCBTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TID0gNTAwO1xuY29uc3QgUkVNT1RFX0RFQlVHR0VSX1BPUlQgPSAyNzc1MztcbmNvbnN0IFNBRkFSSV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaSc7XG5jb25zdCBCTEFOS19QQUdFX1VSTCA9ICdhYm91dDpibGFuayc7XG5cbi8qIEhvdyBtYW55IG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB3ZWJraXQgdG8gcmV0dXJuIGEgcmVzcG9uc2UgYmVmb3JlIHRpbWluZyBvdXQgKi9cbmNvbnN0IFJQQ19SRVNQT05TRV9USU1FT1VUX01TID0gNTAwMDtcblxuY29uc3QgUEFHRV9SRUFEWV9USU1FT1VUID0gNTAwMDtcblxuY29uc3QgR0FSQkFHRV9DT0xMRUNUX1RJTUVPVVQgPSA1MDAwO1xuXG5jb25zdCBBQ1RJVkVfQVBQX0NPREUgPSAwO1xuXG5jbGFzcyBSZW1vdGVEZWJ1Z2dlciBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xuICAvKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgYW4gb3B0cyBoYXNoIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAgIC0gYnVuZGxlSWQgLSBpZCBvZiB0aGUgYXBwIGJlaW5nIGNvbm5lY3RlZCB0b1xuICAgKiAgIC0gYWRkaXRpb25hbEJ1bmRsZUlkcyAtIGFycmF5IG9mIHBvc3NpYmxlIGJ1bmRsZSBpZHMgdGhhdCB0aGUgaW5zcGVjdG9yXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bGQgcmV0dXJuXG4gICAqICAgLSBwbGF0Zm9ybVZlcnNpb24gLSB2ZXJzaW9uIG9mIGlPU1xuICAgKiAgIC0gdXNlTmV3U2FmYXJpIC0gZm9yIHdlYiBpbnNwZWN0b3IsIHdoZXRoZXIgdGhpcyBpcyBhIG5ldyBTYWZhcmkgaW5zdGFuY2VcbiAgICogICAtIHBhZ2VMb2FkTXMgLSB0aGUgdGltZSwgaW4gbXMsIHRoYXQgc2hvdWxkIGJlIHdhaXRlZCBmb3IgcGFnZSBsb2FkaW5nXG4gICAqICAgLSBob3N0IC0gdGhlIHJlbW90ZSBkZWJ1Z2dlcidzIGhvc3QgYWRkcmVzc1xuICAgKiAgIC0gcG9ydCAtIHRoZSByZW1vdGUgZGVidWdnZXIgcG9ydCB0aHJvdWdoIHdoaWNoIHRvIGNvbW11bmljYXRlXG4gICAqICAgLSBsb2dBbGxDb21tdW5pY2F0aW9uIC0gbG9nIHBsaXN0cyBzZW50IGFuZCByZWNlaXZlZCBmcm9tIFdlYiBJbnNwZWN0b3JcbiAgICogICAtIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIC0gbG9nIGNvbW11bmljYXRpb24gZnJvbSBXZWIgSW5zcGVjdG9yIGFzIGhleCBkdW1wXG4gICAqICAgLSBzb2NrZXRDaHVua1NpemUgLSBzaXplLCBpbiBieXRlcywgb2YgY2h1bmtzIG9mIGRhdGEgc2VudCB0byBXZWIgSW5zcGVjdG9yIChyZWFsIGRldmljZSBvbmx5KVxuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBpZiAoVkVSU0lPTikge1xuICAgICAgbG9nLmluZm8oYFJlbW90ZSBEZWJ1Z2dlciB2ZXJzaW9uICR7VkVSU0lPTn1gKTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBidW5kbGVJZCxcbiAgICAgIGFkZGl0aW9uYWxCdW5kbGVJZHMgPSBbXSxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGlzU2FmYXJpID0gdHJ1ZSxcbiAgICAgIGluY2x1ZGVTYWZhcmkgPSBmYWxzZSxcbiAgICAgIHVzZU5ld1NhZmFyaSA9IGZhbHNlLFxuICAgICAgcGFnZUxvYWRNcyxcbiAgICAgIGhvc3QsXG4gICAgICBwb3J0ID0gUkVNT1RFX0RFQlVHR0VSX1BPUlQsXG4gICAgICBzb2NrZXRQYXRoLFxuICAgICAgcGFnZVJlYWR5VGltZW91dCA9IFBBR0VfUkVBRFlfVElNRU9VVCxcbiAgICAgIHJlbW90ZURlYnVnUHJveHksXG4gICAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IGZhbHNlLFxuICAgICAgbG9nRnVsbFJlc3BvbnNlID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgc29ja2V0Q2h1bmtTaXplLFxuICAgICAgZnVsbFBhZ2VJbml0aWFsaXphdGlvbixcbiAgICB9ID0gb3B0cztcblxuICAgIHRoaXMuYnVuZGxlSWQgPSBidW5kbGVJZDtcbiAgICB0aGlzLmFkZGl0aW9uYWxCdW5kbGVJZHMgPSBhZGRpdGlvbmFsQnVuZGxlSWRzO1xuICAgIHRoaXMucGxhdGZvcm1WZXJzaW9uID0gcGxhdGZvcm1WZXJzaW9uO1xuICAgIHRoaXMuaXNTYWZhcmkgPSBpc1NhZmFyaTtcbiAgICB0aGlzLmluY2x1ZGVTYWZhcmkgPSBpbmNsdWRlU2FmYXJpO1xuICAgIHRoaXMudXNlTmV3U2FmYXJpID0gdXNlTmV3U2FmYXJpO1xuICAgIHRoaXMucGFnZUxvYWRNcyA9IHBhZ2VMb2FkTXM7XG4gICAgbG9nLmRlYnVnKGB1c2VOZXdTYWZhcmkgLS0+ICR7dGhpcy51c2VOZXdTYWZhcml9YCk7XG5cbiAgICB0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlID0gZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU7XG5cbiAgICB0aGlzLmhvc3QgPSBob3N0O1xuICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgdGhpcy5zb2NrZXRQYXRoID0gc29ja2V0UGF0aDtcbiAgICB0aGlzLnJlbW90ZURlYnVnUHJveHkgPSByZW1vdGVEZWJ1Z1Byb3h5O1xuICAgIHRoaXMucGFnZVJlYWR5VGltZW91dCA9IHBhZ2VSZWFkeVRpbWVvdXQ7XG5cbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb24gPSBfLmlzTmlsKGxvZ0FsbENvbW11bmljYXRpb24pID8gISFsb2dGdWxsUmVzcG9uc2UgOiAhIWxvZ0FsbENvbW11bmljYXRpb247XG4gICAgdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wO1xuICAgIHRoaXMuc29ja2V0Q2h1bmtTaXplID0gc29ja2V0Q2h1bmtTaXplO1xuXG4gICAgdGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uID0gZnVsbFBhZ2VJbml0aWFsaXphdGlvbjtcblxuICAgIHRoaXMuc2tpcHBlZEFwcHMgPSBbXTtcblxuICAgIHRoaXMuX2xvY2sgPSBuZXcgQXN5bmNMb2NrKCk7XG4gIH1cblxuICBzZXR1cCAoKSB7XG4gICAgLy8gYXBwIGhhbmRsaW5nIGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLmFwcERpY3QgPSB7fTtcbiAgICB0aGlzLmFwcElkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX25hdmlnYXRpbmdUb1BhZ2UgPSBmYWxzZTtcbiAgICB0aGlzLmFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgPSBmYWxzZTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcbiAgICB0aGlzLl9jbGllbnRFdmVudExpc3RlbmVycyA9IHt9O1xuICB9XG5cbiAgdGVhcmRvd24gKCkge1xuICAgIGxvZy5kZWJ1ZygnQ2xlYW5pbmcgdXAgbGlzdGVuZXJzJyk7XG5cbiAgICB0aGlzLmFwcERpY3QgPSB7fTtcbiAgICB0aGlzLmFwcElkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgdGhpcy5ycGNDbGllbnQgPSBudWxsO1xuXG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UpO1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QpO1xuICB9XG5cbiAgaW5pdFJwY0NsaWVudCAoKSB7XG4gICAgdGhpcy5ycGNDbGllbnQgPSBuZXcgUnBjQ2xpZW50U2ltdWxhdG9yKHtcbiAgICAgIGJ1bmRsZUlkOiB0aGlzLmJ1bmRsZUlkLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLnBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGlzU2FmYXJpOiB0aGlzLmlzU2FmYXJpLFxuICAgICAgaG9zdDogdGhpcy5ob3N0LFxuICAgICAgcG9ydDogdGhpcy5wb3J0LFxuICAgICAgc29ja2V0UGF0aDogdGhpcy5zb2NrZXRQYXRoLFxuICAgICAgbWVzc2FnZVByb3h5OiB0aGlzLnJlbW90ZURlYnVnUHJveHksXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uOiB0aGlzLmxvZ0FsbENvbW11bmljYXRpb24sXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDogdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCxcbiAgICAgIGZ1bGxQYWdlSW5pdGlhbGl6YXRpb246IHRoaXMuZnVsbFBhZ2VJbml0aWFsaXphdGlvbixcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNvbm5lY3QgKHRpbWVvdXQgPSBBUFBfQ09OTkVDVF9USU1FT1VUX01TKSB7XG4gICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSB0aGUgcnBjIGNsaWVudFxuICAgIHRoaXMuaW5pdFJwY0NsaWVudCgpO1xuXG4gICAgLy8gbGlzdGVuIGZvciBiYXNpYyBkZWJ1Z2dlci1sZXZlbCBldmVudHNcbiAgICB0aGlzLnJwY0NsaWVudC5vbignX3JwY19yZXBvcnRTZXR1cDonLCBfLm5vb3ApO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX2ZvcndhcmRHZXRMaXN0aW5nOicsIHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX3JlcG9ydENvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdDonLCB0aGlzLm9uQ29ubmVjdGVkQXBwbGljYXRpb25MaXN0LmJpbmQodGhpcykpO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX2FwcGxpY2F0aW9uQ29ubmVjdGVkOicsIHRoaXMub25BcHBDb25uZWN0LmJpbmQodGhpcykpO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX2FwcGxpY2F0aW9uRGlzY29ubmVjdGVkOicsIHRoaXMub25BcHBEaXNjb25uZWN0LmJpbmQodGhpcykpO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX2FwcGxpY2F0aW9uVXBkYXRlZDonLCB0aGlzLm9uQXBwVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIHRoaXMucnBjQ2xpZW50Lm9uKCdfcnBjX3JlcG9ydENvbm5lY3RlZERyaXZlckxpc3Q6JywgdGhpcy5vbkNvbm5lY3RlZERyaXZlckxpc3QuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5ycGNDbGllbnQub24oJ3BhZ2VMb2FkJywgdGhpcy5wYWdlTG9hZC5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnJwY0NsaWVudC5vbignUGFnZS5mcmFtZURldGFjaGVkJywgdGhpcy5mcmFtZURldGFjaGVkLmJpbmQodGhpcykpO1xuXG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuY29ubmVjdCgpO1xuXG4gICAgLy8gZ2V0IHRoZSBjb25uZWN0aW9uIGluZm9ybWF0aW9uIGFib3V0IHRoZSBhcHBcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRDb25uZWN0aW9uS2V5KCk7XG4gICAgICBpZiAodGltZW91dCkge1xuICAgICAgICBsb2cuZGVidWcoYFdhaXRpbmcgdXAgdG8gJHt0aW1lb3V0fW1zIGZvciBhcHBsaWNhdGlvbnMgdG8gYmUgcmVwb3J0ZWRgKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKCgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuYXBwRGljdCk7XG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgd2FpdE1zOiB0aW1lb3V0LFxuICAgICAgICAgICAgaW50ZXJ2YWw6IEFQUF9DT05ORUNUX0lOVEVSVkFMX01TLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYFRpbWVkIG91dCB3YWl0aW5nIGZvciBhcHBsaWNhdGlvbnMgdG8gYmUgcmVwb3J0ZWRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuYXBwRGljdCB8fCB7fTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5lcnJvcihgRXJyb3Igc2V0dGluZyBjb25uZWN0aW9uIGtleTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGF3YWl0IHRoaXMuZGlzY29ubmVjdCgpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRpc2Nvbm5lY3QgKCkge1xuICAgIGlmICh0aGlzLnJwY0NsaWVudCkge1xuICAgICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCwgdHJ1ZSk7XG4gICAgdGhpcy50ZWFyZG93bigpO1xuICB9XG5cbiAgZ2V0IGlzQ29ubmVjdGVkICgpIHtcbiAgICByZXR1cm4gISF0aGlzLnJwY0NsaWVudD8uaXNDb25uZWN0ZWQ7XG4gIH1cblxuICBhc3luYyBzZXRDb25uZWN0aW9uS2V5ICgpIHtcbiAgICBsb2cuZGVidWcoJ1NlbmRpbmcgY29ubmVjdGlvbiBrZXkgcmVxdWVzdCcpO1xuICAgIC8vIHNlbmQgYnV0IG9ubHkgd2FpdCB0byBtYWtlIHN1cmUgdGhlIHNvY2tldCB3b3JrZWRcbiAgICAvLyBhcyByZXNwb25zZSBmcm9tIFdlYiBJbnNwZWN0b3IgY2FuIHRha2UgYSBsb25nIHRpbWVcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRDb25uZWN0aW9uS2V5Jywge30sIGZhbHNlKTtcbiAgfVxuXG4gIHVwZGF0ZUFwcHNXaXRoRGljdCAoZGljdCkge1xuICAgIC8vIGdldCB0aGUgZGljdGlvbmFyeSBlbnRyeSBpbnRvIGEgbmljZSBmb3JtLCBhbmQgYWRkIGl0IHRvIHRoZVxuICAgIC8vIGFwcGxpY2F0aW9uIGRpY3Rpb25hcnlcbiAgICB0aGlzLmFwcERpY3QgPSB0aGlzLmFwcERpY3QgfHwge307XG4gICAgbGV0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgIGlmICh0aGlzLmFwcERpY3RbaWRdKSB7XG4gICAgICAvLyBwcmVzZXJ2ZSB0aGUgcGFnZSBkaWN0aW9uYXJ5IGZvciB0aGlzIGVudHJ5XG4gICAgICBlbnRyeS5wYWdlQXJyYXkgPSB0aGlzLmFwcERpY3RbaWRdLnBhZ2VBcnJheTtcbiAgICB9XG4gICAgdGhpcy5hcHBEaWN0W2lkXSA9IGVudHJ5O1xuXG4gICAgLy8gYWRkIGEgcHJvbWlzZSB0byBnZXQgdGhlIHBhZ2UgZGljdGlvbmFyeVxuICAgIGlmIChfLmlzVW5kZWZpbmVkKGVudHJ5LnBhZ2VBcnJheSkpIHtcbiAgICAgIGVudHJ5LnBhZ2VBcnJheSA9IGRlZmVycmVkUHJvbWlzZSgpO1xuICAgIH1cblxuICAgIC8vIHRyeSB0byBnZXQgdGhlIGFwcCBpZCBmcm9tIG91ciBjb25uZWN0ZWQgYXBwc1xuICAgIGlmICghdGhpcy5hcHBJZEtleSkge1xuICAgICAgdGhpcy5hcHBJZEtleSA9IGdldERlYnVnZ2VyQXBwS2V5KHRoaXMuYnVuZGxlSWQsIHRoaXMuYXBwRGljdCk7XG4gICAgfVxuICB9XG5cbiAgbG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IChhcHBzKSB7XG4gICAgZnVuY3Rpb24gZ2V0VmFsdWVTdHJpbmcgKGtleSwgdmFsdWUpIHtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSB7XG4gICAgICAgIHJldHVybiAnW0Z1bmN0aW9uXSc7XG4gICAgICB9XG4gICAgICBpZiAoa2V5ID09PSAncGFnZUFycmF5JyAmJiAhXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gYCdXYWl0aW5nIGZvciBkYXRhJ2A7XG4gICAgICB9XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH1cbiAgICBsb2cuZGVidWcoJ0N1cnJlbnQgYXBwbGljYXRpb25zIGF2YWlsYWJsZTonKTtcbiAgICBmb3IgKGNvbnN0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyhhcHBzKSkge1xuICAgICAgbG9nLmRlYnVnKGAgICAgQXBwbGljYXRpb246ICcke2FwcH0nYCk7XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoaW5mbykpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ3BhZ2VBcnJheScgJiYgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGAgICAgICAgICR7a2V5fTpgKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdmFsdWUpIHtcbiAgICAgICAgICAgIGxldCBwcmVmaXggPSAnLSAnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbaywgdl0gb2YgXy50b1BhaXJzKHBhZ2UpKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAgICR7cHJlZml4fSR7a306ICR7SlNPTi5zdHJpbmdpZnkodil9YCk7XG4gICAgICAgICAgICAgIHByZWZpeCA9ICcgICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHZhbHVlU3RyaW5nID0gZ2V0VmFsdWVTdHJpbmcoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgbG9nLmRlYnVnKGAgICAgICAgICR7a2V5fTogJHt2YWx1ZVN0cmluZ31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbGVjdEFwcCAoY3VycmVudFVybCA9IG51bGwsIG1heFRyaWVzID0gU0VMRUNUX0FQUF9SRVRSSUVTLCBpZ25vcmVBYm91dEJsYW5rVXJsID0gZmFsc2UpIHtcbiAgICBjb25zdCBzaG91bGRDaGVja0ZvclRhcmdldCA9IHRoaXMucnBjQ2xpZW50LnNob3VsZENoZWNrRm9yVGFyZ2V0O1xuICAgIHRoaXMucnBjQ2xpZW50LnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgICBsb2cuZGVidWcoJ1NlbGVjdGluZyBhcHBsaWNhdGlvbicpO1xuICAgICAgaWYgKCF0aGlzLmFwcERpY3QgfHwgXy5pc0VtcHR5KHRoaXMuYXBwRGljdCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdObyBhcHBsaWNhdGlvbnMgY3VycmVudGx5IGNvbm5lY3RlZC4nKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7YXBwSWRLZXksIHBhZ2VEaWN0fSA9IGF3YWl0IHRoaXMuc2VhcmNoRm9yQXBwKGN1cnJlbnRVcmwsIG1heFRyaWVzLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcblxuICAgICAgLy8gaWYsIGFmdGVyIGFsbCB0aGlzLCB3ZSBoYXZlIG5vIGRpY3Rpb25hcnksIHdlIGhhdmUgZmFpbGVkXG4gICAgICBpZiAoIWFwcElkS2V5IHx8ICFwYWdlRGljdCkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXIgJHttYXhUcmllc30gdHJpZXMuYCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGFsdGVyZWQgYXBwIGlkLCB1cGRhdGluZyBmcm9tICcke3RoaXMuYXBwSWRLZXl9JyB0byAnJHthcHBJZEtleX0nYCk7XG4gICAgICAgIHRoaXMuYXBwSWRLZXkgPSBhcHBJZEtleTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcblxuICAgICAgLy8gdHJhbnNsYXRlIHRoZSBkaWN0aW9uYXJ5IGludG8gYSB1c2VmdWwgZm9ybSwgYW5kIHJldHVybiB0byBzZW5kZXJcbiAgICAgIGNvbnN0IHBhZ2VBcnJheSA9IF8uaXNFbXB0eSh0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSlcbiAgICAgICAgPyBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdClcbiAgICAgICAgOiB0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheTtcbiAgICAgIGxvZy5kZWJ1ZyhgRmluYWxseSBzZWxlY3RpbmcgYXBwICR7dGhpcy5hcHBJZEtleX06ICR7c2ltcGxlU3RyaW5naWZ5KHBhZ2VBcnJheSl9YCk7XG5cbiAgICAgIGxldCBmdWxsUGFnZUFycmF5ID0gW107XG4gICAgICBmb3IgKGNvbnN0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgIGlmICghXy5pc0FycmF5KGluZm8ucGFnZUFycmF5KSB8fCBpbmZvLmlzQWN0aXZlID09PSBBQ1RJVkVfQVBQX0NPREUpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZCA9IGFwcC5yZXBsYWNlKCdQSUQ6JywgJycpO1xuICAgICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgaW5mby5wYWdlQXJyYXkpIHtcbiAgICAgICAgICBpZiAoIShpZ25vcmVBYm91dEJsYW5rVXJsICYmIHBhZ2UudXJsID09PSBCTEFOS19QQUdFX1VSTCkpIHtcbiAgICAgICAgICAgIGxldCBwYWdlRGljdCA9IF8uY2xvbmUocGFnZSk7XG4gICAgICAgICAgICBwYWdlRGljdC5pZCA9IGAke2lkfS4ke3BhZ2VEaWN0LmlkfWA7XG4gICAgICAgICAgICBwYWdlRGljdC5idW5kbGVJZCA9IGluZm8uYnVuZGxlSWQ7XG4gICAgICAgICAgICBmdWxsUGFnZUFycmF5LnB1c2gocGFnZURpY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2cuZGVidWcoYFNlbGVjdGVkIGFwcCBhZnRlciAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNNaWxsaVNlY29uZHMudG9GaXhlZCgwKX1tc2ApO1xuICAgICAgcmV0dXJuIGZ1bGxQYWdlQXJyYXk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMucnBjQ2xpZW50LnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VhcmNoRm9yQXBwIChjdXJyZW50VXJsLCBtYXhUcmllcywgaWdub3JlQWJvdXRCbGFua1VybCkge1xuICAgIGNvbnN0IGJ1bmRsZUlkcyA9IHRoaXMuaW5jbHVkZVNhZmFyaSAmJiAhdGhpcy5pc1NhZmFyaVxuICAgICAgPyBbdGhpcy5idW5kbGVJZCwgLi4udGhpcy5hZGRpdGlvbmFsQnVuZGxlSWRzLCBTQUZBUklfQlVORExFX0lEXVxuICAgICAgOiBbdGhpcy5idW5kbGVJZCwgLi4udGhpcy5hZGRpdGlvbmFsQnVuZGxlSWRzXTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5SW50ZXJ2YWwobWF4VHJpZXMsIFNFTEVDVF9BUFBfUkVUUllfU0xFRVBfTVMsIGFzeW5jIChyZXRyeUNvdW50KSA9PiB7XG4gICAgICAgIHRoaXMubG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5KHRoaXMuYXBwRGljdCk7XG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXBwSWRzID0gZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMoYnVuZGxlSWRzLCB0aGlzLmFwcERpY3QpO1xuICAgICAgICBsb2cuZGVidWcoYFRyeWluZyBvdXQgdGhlIHBvc3NpYmxlIGFwcCBpZHM6ICR7cG9zc2libGVBcHBJZHMuam9pbignLCAnKX0gKHRyeSAjJHtyZXRyeUNvdW50ICsgMX0gb2YgJHttYXhUcmllc30pYCk7XG4gICAgICAgIGZvciAoY29uc3QgYXR0ZW1wdGVkQXBwSWRLZXkgb2YgcG9zc2libGVBcHBJZHMpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXBwRGljdFthdHRlbXB0ZWRBcHBJZEtleV0uaXNBY3RpdmUgPT09IEFDVElWRV9BUFBfQ09ERSkge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYFNraXBwaW5nIGFwcCAnJHthdHRlbXB0ZWRBcHBJZEtleX0nIGJlY2F1c2UgaXQgaXMgbm90IGFjdGl2ZWApO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgQXR0ZW1wdGluZyBhcHAgJyR7YXR0ZW1wdGVkQXBwSWRLZXl9J2ApO1xuICAgICAgICAgICAgY29uc3QgW2FwcElkS2V5LCBwYWdlRGljdF0gPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZWxlY3RBcHAoYXR0ZW1wdGVkQXBwSWRLZXksIHRoaXMub25BcHBDb25uZWN0LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgLy8gaW4gaU9TIDguMiB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgICAgICAvLyB3aGljaCBsZWFkcyB0byB0aGUgcmVtb3RlIGRlYnVnZ2VyIGdldHRpbmcgZGlzY29ubmVjdGVkLCBhbmQgaW50byBhIGxvb3BcbiAgICAgICAgICAgIGlmIChfLmlzRW1wdHkocGFnZURpY3QpKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZygnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkLiBUcnlpbmcgYWdhaW4uJyk7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzYXZlIHRoZSBwYWdlIGFycmF5IGZvciB0aGlzIGFwcFxuICAgICAgICAgICAgdGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXkgPSBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdCk7XG5cbiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBsb29raW5nIGZvciBhIHBhcnRpY3VsYXIgdXJsLCBtYWtlIHN1cmUgd2VcbiAgICAgICAgICAgIC8vIGhhdmUgdGhlIHJpZ2h0IHBhZ2UuIElnbm9yZSBlbXB0eSBvciB1bmRlZmluZWQgdXJscy5cbiAgICAgICAgICAgIC8vIElnbm9yZSBhYm91dDpibGFuayBpZiByZXF1ZXN0ZWQuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNlYXJjaEZvclBhZ2UodGhpcy5hcHBEaWN0LCBjdXJyZW50VXJsLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhcHAsIGJ1dCBleHBlY3RlZCB1cmwgKCcke2N1cnJlbnRVcmx9Jykgd2FzIG5vdCBmb3VuZC4gVHJ5aW5nIGFnYWluLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBhcHAsIGJ1dCBubyBtYXRjaCB3YXMgZm91bmQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgRXJyb3IgY2hlY2tpbmcgYXBwbGljYXRpb246ICcke2Vyci5tZXNzYWdlfScuIFJldHJ5aW5nIGNvbm5lY3Rpb25gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0cnlDb3VudCsrO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGFuIGFwcCB0byBzZWxlY3QnKTtcbiAgICAgIH0sIDApO1xuICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyICR7bWF4VHJpZXN9IHRyaWVzLmApO1xuICAgIH1cbiAgfVxuXG4gIHNlYXJjaEZvclBhZ2UgKGFwcHNEaWN0LCBjdXJyZW50VXJsID0gbnVsbCwgaWdub3JlQWJvdXRCbGFua1VybCA9IGZhbHNlKSB7XG4gICAgZm9yIChjb25zdCBhcHBEaWN0IG9mIF8udmFsdWVzKGFwcHNEaWN0KSkge1xuICAgICAgaWYgKCFhcHBEaWN0IHx8IGFwcERpY3QuaXNBY3RpdmUgPT09IEFDVElWRV9BUFBfQ09ERSB8fCAhYXBwRGljdC5wYWdlQXJyYXkgfHwgYXBwRGljdC5wYWdlQXJyYXkucHJvbWlzZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBkaWN0IG9mIGFwcERpY3QucGFnZUFycmF5KSB7XG4gICAgICAgIGlmICgoIWlnbm9yZUFib3V0QmxhbmtVcmwgfHwgZGljdC51cmwgIT09IEJMQU5LX1BBR0VfVVJMKSAmJlxuICAgICAgICAgICAgKCFjdXJyZW50VXJsIHx8IGRpY3QudXJsID09PSBjdXJyZW50VXJsIHx8IGRpY3QudXJsID09PSBgJHtjdXJyZW50VXJsfS9gKSkge1xuICAgICAgICAgIHJldHVybiB7IGFwcElkS2V5OiBhcHBEaWN0LmlkLCBwYWdlRGljdDogZGljdCB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgYXN5bmMgc2VsZWN0UGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2sgPSBmYWxzZSkge1xuICAgIHRoaXMuYXBwSWRLZXkgPSBgUElEOiR7YXBwSWRLZXl9YDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IHBhZ2VJZEtleTtcblxuICAgIGxvZy5kZWJ1ZyhgU2VsZWN0aW5nIHBhZ2UgJyR7cGFnZUlkS2V5fScgb24gYXBwICcke3RoaXMuYXBwSWRLZXl9JyBhbmQgZm9yd2FyZGluZyBzb2NrZXQgc2V0dXBgKTtcblxuICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG5cbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZWxlY3RQYWdlKHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleSk7XG5cbiAgICAvLyBtYWtlIHN1cmUgZXZlcnl0aGluZyBpcyByZWFkeSB0byBnb1xuICAgIGlmICghc2tpcFJlYWR5Q2hlY2sgJiYgIWF3YWl0IHRoaXMuY2hlY2tQYWdlSXNSZWFkeSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnBhZ2VVbmxvYWQoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFNlbGVjdGVkIHBhZ2UgYWZ0ZXIgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tIChhdG9tLCBhcmdzLCBmcmFtZXMpIHtcbiAgICBpZiAoIXRoaXMucnBjQ2xpZW50LmlzQ29ubmVjdGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlbW90ZSBkZWJ1Z2dlciBpcyBub3QgY29ubmVjdGVkJyk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgYXRvbSAnJHthdG9tfSdgKTtcbiAgICBjb25zdCBzY3JpcHQgPSBhd2FpdCBnZXRTY3JpcHRGb3JBdG9tKGF0b20sIGFyZ3MsIGZyYW1lcyk7XG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoc2NyaXB0LCB0cnVlKTtcbiAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3VsdCBmb3IgYXRvbSAnJHthdG9tfScgZXhlY3V0aW9uOiAke18udHJ1bmNhdGUoc2ltcGxlU3RyaW5naWZ5KHZhbHVlKSwge2xlbmd0aDogUkVTUE9OU0VfTE9HX0xFTkdUSH0pfWApO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tQXN5bmMgKGF0b20sIGFyZ3MsIGZyYW1lcykge1xuICAgIC8vIGhlbHBlciB0byBzZW5kIGRpcmVjdGx5IHRvIHRoZSB3ZWIgaW5zcGVjdG9yXG4gICAgY29uc3QgZXZhbHVhdGUgPSBhc3luYyAobWV0aG9kLCBvcHRzKSA9PiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZChtZXRob2QsIHtcbiAgICAgICAgLi4ub3B0cyxcbiAgICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICAgIHJldHVybkJ5VmFsdWU6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIGZpcnN0IGNyZWF0ZSBhIFByb21pc2Ugb24gdGhlIHBhZ2UsIHNhdmluZyB0aGUgcmVzb2x2ZS9yZWplY3QgZnVuY3Rpb25zXG4gICAgLy8gYXMgcHJvcGVydGllc1xuICAgIGNvbnN0IHByb21pc2VOYW1lID0gYGFwcGl1bUFzeW5jRXhlY3V0ZVByb21pc2Uke1VVSUQuY3JlYXRlKCkudG9TdHJpbmcoKS5yZXBsYWNlKC8tL2csICcnKX1gO1xuICAgIGNvbnN0IHNjcmlwdCA9XG4gICAgICBgdmFyIHJlcywgcmVqO1xuICAgICAgd2luZG93LiR7cHJvbWlzZU5hbWV9ID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICByZXMgPSByZXNvbHZlO1xuICAgICAgICByZWogPSByZWplY3Q7XG4gICAgICB9KTtcbiAgICAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfS5yZXNvbHZlID0gcmVzO1xuICAgICAgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlamVjdCA9IHJlajtcbiAgICAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfTtgO1xuICAgIGNvbnN0IG9iaiA9IGF3YWl0IGV2YWx1YXRlKCdSdW50aW1lLmV2YWx1YXRlJywge2NvbW1hbmQ6IHNjcmlwdH0pO1xuICAgIGNvbnN0IHByb21pc2VPYmplY3RJZCA9IG9iai5yZXN1bHQub2JqZWN0SWQ7XG5cbiAgICAvLyBleGVjdXRlIHRoZSBhdG9tLCBjYWxsaW5nIGJhY2sgdG8gdGhlIHJlc29sdmUgZnVuY3Rpb25cbiAgICBjb25zdCBhc3luY0NhbGxCYWNrID1cbiAgICAgIGBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfS5yZXNvbHZlKHJlcyk7XG4gICAgICAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfVZhbHVlID0gcmVzO1xuICAgICAgfWA7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlKGF3YWl0IGdldFNjcmlwdEZvckF0b20oYXRvbSwgYXJncywgZnJhbWVzLCBhc3luY0NhbGxCYWNrKSk7XG5cbiAgICAvLyB3YWl0IGZvciB0aGUgcHJvbWlzZSB0byBiZSByZXNvbHZlZFxuICAgIGxldCByZXM7XG4gICAgY29uc3Qgc3ViY29tbWFuZFRpbWVvdXQgPSAxMDAwOyAvLyB0aW1lb3V0IG9uIGluZGl2aWR1YWwgY29tbWFuZHNcbiAgICB0cnkge1xuICAgICAgcmVzID0gYXdhaXQgZXZhbHVhdGUoJ1J1bnRpbWUuYXdhaXRQcm9taXNlJywge3Byb21pc2VPYmplY3RJZH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcyhgJ1J1bnRpbWUuYXdhaXRQcm9taXNlJyB3YXMgbm90IGZvdW5kYCkpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgLy8gYXdhaXRQcm9taXNlIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBzbyBzaW11bGF0ZSBpdCB3aXRoIHBvbGxcbiAgICAgIGNvbnN0IHJldHJ5V2FpdCA9IDEwMDtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSAoYXJncy5sZW5ndGggPj0gMykgPyBhcmdzWzJdIDogUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVM7XG4gICAgICAvLyBpZiB0aGUgdGltZW91dCBtYXRoIHR1cm5zIHVwIDAgcmV0cmllcywgbWFrZSBzdXJlIGl0IGhhcHBlbnMgb25jZVxuICAgICAgY29uc3QgcmV0cmllcyA9IHBhcnNlSW50KHRpbWVvdXQgLyByZXRyeVdhaXQsIDEwKSB8fCAxO1xuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICAgIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3RpbWVvdXR9bXMgZm9yIGFzeW5jIGV4ZWN1dGUgdG8gZmluaXNoYCk7XG4gICAgICByZXMgPSBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIHJldHJ5V2FpdCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyB0aGUgYXRvbSBfd2lsbF8gcmV0dXJuLCBlaXRoZXIgYmVjYXVzZSBpdCBmaW5pc2hlZCBvciBhbiBlcnJvclxuICAgICAgICAvLyBpbmNsdWRpbmcgYSB0aW1lb3V0IGVycm9yXG4gICAgICAgIGNvbnN0IGhhc1ZhbHVlID0gYXdhaXQgZXZhbHVhdGUoJ1J1bnRpbWUuZXZhbHVhdGUnLCB7XG4gICAgICAgICAgY29tbWFuZDogYHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnJHtwcm9taXNlTmFtZX1WYWx1ZScpO2AsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaGFzVmFsdWUpIHtcbiAgICAgICAgICAvLyB3ZSBvbmx5IHB1dCB0aGUgcHJvcGVydHkgb24gYHdpbmRvd2Agd2hlbiB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkLFxuICAgICAgICAgIC8vIHNvIGlmIGl0IGlzIHRoZXJlLCBldmVyeXRoaW5nIGlzIGRvbmVcbiAgICAgICAgICByZXR1cm4gYXdhaXQgZXZhbHVhdGUoJ1J1bnRpbWUuZXZhbHVhdGUnLCB7XG4gICAgICAgICAgICBjb21tYW5kOiBgd2luZG93LiR7cHJvbWlzZU5hbWV9VmFsdWU7YCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aHJvdyBhIFRpbWVvdXRFcnJvciwgb3IgZWxzZSBpdCBuZWVkcyB0byBiZSBjYXVnaHQgYW5kIHJlLXRocm93blxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlRpbWVvdXRFcnJvcihgVGltZWQgb3V0IHdhaXRpbmcgZm9yIGFzeW5jaHJvbm91cyBzY3JpcHQgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGByZXN1bHQgYWZ0ZXIgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXMnKSk7YCk7XG4gICAgICB9KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gdHJ5IHRvIGdldCByaWQgb2YgdGhlIHByb21pc2VcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbYGRlbGV0ZSB3aW5kb3cuJHtwcm9taXNlTmFtZX07YCwgW251bGwsIG51bGxdLCBzdWJjb21tYW5kVGltZW91dF0sIGZyYW1lcyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0UmVzdWx0KHJlcyk7XG4gIH1cblxuICBmcmFtZURldGFjaGVkICgpIHtcbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVEKTtcbiAgfVxuXG4gIGFzeW5jIHBhZ2VMb2FkIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxldCB0aW1lb3V0TXMgPSA1MDA7XG4gICAgbGV0IHN0YXJ0ID0gc3RhcnRQYWdlTG9hZE1zIHx8IERhdGUubm93KCk7XG5cbiAgICBsb2cuZGVidWcoJ1BhZ2UgbG9hZGVkLCB2ZXJpZnlpbmcgd2hldGhlciByZWFkeScpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSB0cnVlO1xuXG4gICAgY29uc3QgdmVyaWZ5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wYWdlTG9hZERlbGF5ID0gdXRpbC5jYW5jZWxsYWJsZURlbGF5KHRpbWVvdXRNcyk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnBhZ2VMb2FkRGVsYXk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuQ2FuY2VsbGF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBpZiB0aGUgcHJvbWlzZSBoYXMgYmVlbiBjYW5jZWxsZWRcbiAgICAgICAgICAvLyB3ZSB3YW50IHRvIHNraXAgY2hlY2tpbmcgdGhlIHJlYWRpbmVzc1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjYW4gZ2V0IHRoaXMgY2FsbGVkIGluIHRoZSBtaWRkbGUgb2YgdHJ5aW5nIHRvIGZpbmQgYSBuZXcgYXBwXG4gICAgICBpZiAoIXRoaXMuYXBwSWRLZXkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdOb3QgY29ubmVjdGVkIHRvIGFuIGFwcGxpY2F0aW9uLiBJZ25vcmluZyBwYWdlIGxvYWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHBhZ2VMb2FkVmVyaWZ5SG9vaykpIHtcbiAgICAgICAgYXdhaXQgcGFnZUxvYWRWZXJpZnlIb29rKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWR5ID0gYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCk7XG5cbiAgICAgIC8vIGlmIHdlIGFyZSByZWFkeSwgb3Igd2UndmUgc3BlbmQgdG9vIG11Y2ggdGltZSBvbiB0aGlzXG4gICAgICBpZiAocmVhZHkgfHwgKHRoaXMucGFnZUxvYWRNcyA+IDAgJiYgKHN0YXJ0ICsgdGhpcy5wYWdlTG9hZE1zKSA8IERhdGUubm93KCkpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnUGFnZSBpcyByZWFkeScpO1xuICAgICAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoJ1BhZ2Ugd2FzIG5vdCByZWFkeSwgcmV0cnlpbmcnKTtcbiAgICAgICAgYXdhaXQgdmVyaWZ5KCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBhd2FpdCB2ZXJpZnkoKTtcbiAgfVxuXG4gIGNhbmNlbFBhZ2VMb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1VucmVnaXN0ZXJpbmcgZnJvbSBwYWdlIHJlYWRpbmVzcyBub3RpZmljYXRpb25zJyk7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnBhZ2VMb2FkRGVsYXkpIHtcbiAgICAgIHRoaXMucGFnZUxvYWREZWxheS5jYW5jZWwoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBwYWdlVW5sb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1BhZ2UgdW5sb2FkaW5nJyk7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKCk7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yRG9tIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgZG9tLi4uJyk7XG4gICAgYXdhaXQgdGhpcy5wYWdlTG9hZChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vayk7XG4gIH1cblxuICBhc3luYyBjaGVja1BhZ2VJc1JlYWR5ICgpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgbG9nLmRlYnVnKCdDaGVja2luZyBkb2N1bWVudCByZWFkeVN0YXRlJyk7XG4gICAgY29uc3QgcmVhZHlDbWQgPSAnZG9jdW1lbnQucmVhZHlTdGF0ZTsnO1xuICAgIGxldCByZWFkeVN0YXRlID0gJ2xvYWRpbmcnO1xuICAgIHRyeSB7XG4gICAgICByZWFkeVN0YXRlID0gYXdhaXQgQi5yZXNvbHZlKHRoaXMuZXhlY3V0ZShyZWFkeUNtZCwgdHJ1ZSkpLnRpbWVvdXQodGhpcy5wYWdlUmVhZHlUaW1lb3V0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoYFBhZ2UgcmVhZGluZXNzIGNoZWNrIHRpbWVkIG91dCBhZnRlciAke3RoaXMucGFnZVJlYWR5VGltZW91dH1tc2ApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYERvY3VtZW50IHJlYWR5U3RhdGUgaXMgJyR7cmVhZHlTdGF0ZX0nYCk7XG5cbiAgICByZXR1cm4gcmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJztcbiAgfVxuXG4gIGFzeW5jIGxhdW5jaFNhZmFyaSAoKSB7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnbGF1bmNoQXBwbGljYXRpb24nLCB7XG4gICAgICBidW5kbGVJZDogU0FGQVJJX0JVTkRMRV9JRFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbmF2VG9VcmwgKHVybCwgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7XG4gICAgfVxuXG4gICAgdGhpcy5fbmF2aWdhdGluZ1RvUGFnZSA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbG9nLmRlYnVnKGBOYXZpZ2F0aW5nIHRvIG5ldyBVUkw6ICcke3VybH0nYCk7XG5cbiAgICAgIC8vIGJlZ2luIGxpc3RlbmluZyBmb3IgZnJhbWUgbmF2aWdhdGlvbiBldmVudCwgd2hpY2ggd2lsbCBiZSB3YWl0ZWQgZm9yIGxhdGVyXG4gICAgICBjb25zdCB3YWl0Rm9yRnJhbWVQcm9taXNlID0gdGhpcy53YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQoKTtcblxuICAgICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnUGFnZS5uYXZpZ2F0ZScsIHtcbiAgICAgICAgdXJsLFxuICAgICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRoaXMudXNlTmV3U2FmYXJpKSB7XG4gICAgICAgIC8vIGEgc21hbGwgcGF1c2UgZm9yIHRoZSBicm93c2VyIHRvIGNhdGNoIHVwXG4gICAgICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIHdhaXQgdW50aWwgdGhlIHBhZ2UgaGFzIGJlZW4gbmF2aWdhdGVkXG4gICAgICBhd2FpdCB3YWl0Rm9yRnJhbWVQcm9taXNlO1xuXG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oRGF0ZS5ub3coKSwgcGFnZUxvYWRWZXJpZnlIb29rKTtcblxuICAgICAgLy8gZW5hYmxlIGNvbnNvbGUgbG9nZ2luZywgc28gd2UgZ2V0IHRoZSBldmVudHMgKG90aGVyd2lzZSB3ZSBvbmx5XG4gICAgICAvLyBnZXQgbm90aWZpZWQgd2hlbiBuYXZpZ2F0aW5nIHRvIGEgbG9jYWwgcGFnZVxuICAgICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnQ29uc29sZS5lbmFibGUnLCB7XG4gICAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgfSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX25hdmlnYXRpbmdUb1BhZ2UgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQgKCkge1xuICAgIGxldCBuYXZFdmVudExpc3RlbmVyO1xuICAgIHJldHVybiBhd2FpdCBuZXcgQihhc3luYyAocmVzb2x2ZSkgPT4ge1xuICAgICAgbG9nLmRlYnVnKCdXYWl0aW5nIGZvciBmcmFtZSBuYXZpZ2F0ZWQgbWVzc2FnZS4uLicpO1xuICAgICAgbGV0IHN0YXJ0TXMgPSBEYXRlLm5vdygpO1xuXG4gICAgICAvLyBhZGQgYSBoYW5kbGVyIGZvciB0aGUgYFBhZ2UuZnJhbWVOYXZpZ2F0ZWRgIG1lc3NhZ2VcbiAgICAgIC8vIGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgbmF2RXZlbnRMaXN0ZW5lciA9IChlcnIsIHZhbHVlKSA9PiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgRnJhbWUgbmF2aWdhdGVkIGluICR7KChEYXRlLm5vdygpIC0gc3RhcnRNcykgLyAxMDAwKX1zIGZyb206ICR7dmFsdWV9YCk7XG4gICAgICAgIGlmICghdGhpcy5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkICYmICF0aGlzLnBhZ2VMb2FkaW5nKSB7XG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nLmRlYnVnKCdGcmFtZSBuYXZpZ2F0ZWQgYnV0IHdlIHdlcmUgd2FybmVkIGFib3V0IGl0LCBub3QgJyArXG4gICAgICAgICAgICAgICAgICAgICdjb25zaWRlcmluZyBwYWdlIHN0YXRlIHVubG9hZGVkJyk7XG4gICAgICAgICAgdGhpcy5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmF2aWdhdGlvbkRlbGF5KSB7XG4gICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRGVsYXkuY2FuY2VsKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHRoaXMucnBjQ2xpZW50Lm9uY2UoJ1BhZ2UuZnJhbWVOYXZpZ2F0ZWQnLCBuYXZFdmVudExpc3RlbmVyKTtcblxuICAgICAgLy8gdGltZW91dCwgaW4gY2FzZSByZW1vdGUgZGVidWdnZXIgZG9lc24ndCByZXNwb25kLFxuICAgICAgLy8gb3IgdGFrZXMgYSBsb25nIHRpbWVcbiAgICAgIGlmICghdGhpcy51c2VOZXdTYWZhcmkgfHwgdGhpcy5wYWdlTG9hZE1zID49IDApIHtcbiAgICAgICAgLy8gdXNlIHBhZ2VMb2FkTXMsIG9yIGEgc21hbGwgYW1vdW50IG9mIHRpbWVcbiAgICAgICAgY29uc3QgdGltZW91dCA9IHRoaXMudXNlTmV3U2FmYXJpID8gdGhpcy5wYWdlTG9hZE1zIDogNTAwO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheSA9IHV0aWwuY2FuY2VsbGFibGVEZWxheSh0aW1lb3V0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLm5hdmlnYXRpb25EZWxheTtcbiAgICAgICAgICBuYXZFdmVudExpc3RlbmVyKG51bGwsIGAke3RpbWVvdXR9bXMgdGltZW91dGApO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBub3RoaW5nIHRvIGRvOiB3ZSBvbmx5IGdldCBoZXJlIGlmIHRoZSByZW1vdGUgZGVidWdnZXJcbiAgICAgICAgICAvLyBhbHJlYWR5IG5vdGlmaWVkIG9mIGZyYW1lIG5hdmlnYXRpb24sIGFuZCB0aGUgZGVsYXlcbiAgICAgICAgICAvLyB3YXMgY2FuY2VsbGVkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgIGlmIChuYXZFdmVudExpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMucnBjQ2xpZW50Lm9mZignUGFnZS5mcmFtZU5hdmlnYXRlZCcsIG5hdkV2ZW50TGlzdGVuZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRUaW1lbGluZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICB0aGlzLnJwY0NsaWVudC5vbignVGltZWxpbmUuZXZlbnRSZWNvcmRlZCcsIGZuKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RhcnRUaW1lbGluZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BUaW1lbGluZSAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byByZWNvcmQgdGhlIHRpbWVsaW5lJyk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnVGltZWxpbmUuc3RvcCcsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqIEtlZXAgdHJhY2sgb2YgdGhlIGNsaWVudCBldmVudCBsaXN0ZW5lcnMgc28gdGhleSBjYW4gYmUgcmVtb3ZlZFxuICAgKi9cbiAgYWRkQ2xpZW50RXZlbnRMaXN0ZW5lciAoZXZlbnROYW1lLCBsaXN0ZW5lcikge1xuICAgIHRoaXMuX2NsaWVudEV2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0gPSB0aGlzLl9jbGllbnRFdmVudExpc3RlbmVyc1tldmVudE5hbWVdIHx8IFtdO1xuICAgIHRoaXMuX2NsaWVudEV2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0ucHVzaChsaXN0ZW5lcik7XG4gICAgdGhpcy5ycGNDbGllbnQub24oZXZlbnROYW1lLCBsaXN0ZW5lcik7XG4gIH1cblxuICByZW1vdmVDbGllbnRFdmVudExpc3RlbmVyIChldmVudE5hbWUpIHtcbiAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mICh0aGlzLl9jbGllbnRFdmVudExpc3RlbmVyc1tldmVudE5hbWVdIHx8IFtdKSkge1xuICAgICAgdGhpcy5ycGNDbGllbnQub2ZmKGV2ZW50TmFtZSwgbGlzdGVuZXIpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXJ0Q29uc29sZSAobGlzdGVuZXIpIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgdGhpcy5hZGRDbGllbnRFdmVudExpc3RlbmVyKCdDb25zb2xlLm1lc3NhZ2VBZGRlZCcsIGxpc3RlbmVyKTtcbiAgICB0aGlzLmFkZENsaWVudEV2ZW50TGlzdGVuZXIoJ0NvbnNvbGUubWVzc2FnZVJlcGVhdENvdW50VXBkYXRlZCcsIGxpc3RlbmVyKTtcbiAgfVxuXG4gIHN0b3BDb25zb2xlICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIGxpc3RlbiBmb3IgSmF2YVNjcmlwdCBjb25zb2xlJyk7XG4gICAgdGhpcy5yZW1vdmVDbGllbnRFdmVudExpc3RlbmVyKCdDb25zb2xlLm1lc3NhZ2VBZGRlZCcpO1xuICAgIHRoaXMucmVtb3ZlQ2xpZW50RXZlbnRMaXN0ZW5lcignQ29uc29sZS5tZXNzYWdlUmVwZWF0Q291bnRVcGRhdGVkJyk7XG4gIH1cblxuICBzdGFydE5ldHdvcmsgKGxpc3RlbmVyKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgdGhpcy5hZGRDbGllbnRFdmVudExpc3RlbmVyKCdOZXR3b3JrRXZlbnQnLCBsaXN0ZW5lcik7XG4gIH1cblxuICBzdG9wTmV0d29yayAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgdGhpcy5yZW1vdmVDbGllbnRFdmVudExpc3RlbmVyKCdOZXR3b3JrRXZlbnQnKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUgKGNvbW1hbmQsIG92ZXJyaWRlKSB7XG4gICAgLy8gaWYgdGhlIHBhZ2UgaXMgbm90IGxvYWRlZCB5ZXQsIHdhaXQgZm9yIGl0XG4gICAgaWYgKHRoaXMucGFnZUxvYWRpbmcgJiYgIW92ZXJyaWRlKSB7XG4gICAgICBsb2cuZGVidWcoJ1RyeWluZyB0byBleGVjdXRlIGJ1dCBwYWdlIGlzIG5vdCBsb2FkZWQuJyk7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oKTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSkge1xuICAgICAgYXdhaXQgdGhpcy5nYXJiYWdlQ29sbGVjdCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyBqYXZhc2NyaXB0IGNvbW1hbmQ6ICcke18udHJ1bmNhdGUoY29tbWFuZCwge2xlbmd0aDogNTB9KX0nYCk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnUnVudGltZS5ldmFsdWF0ZScsIHtcbiAgICAgIGNvbW1hbmQsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgYXN5bmMgY2FsbEZ1bmN0aW9uIChvYmpJZCwgZm4sIGFyZ3MpIHtcbiAgICBsZXQgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgIGlmICh0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlKSB7XG4gICAgICBhd2FpdCB0aGlzLmdhcmJhZ2VDb2xsZWN0KCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKCdDYWxsaW5nIGphdmFzY3JpcHQgZnVuY3Rpb24nKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdSdW50aW1lLmNhbGxGdW5jdGlvbk9uJywge1xuICAgICAgb2JqSWQsXG4gICAgICBmbixcbiAgICAgIGFyZ3MsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgc2V0IGFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgKGFsbG93KSB7XG4gICAgdGhpcy5fYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCA9IGFsbG93O1xuICB9XG5cbiAgZ2V0IGFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgKCkge1xuICAgIHJldHVybiB0aGlzLl9hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q29va2llcyAodXJscykge1xuICAgIGxvZy5kZWJ1ZygnR2V0dGluZyBuZXR3b3JrIGNvb2tpZXMnKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnUGFnZS5nZXRDb29raWVzJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgdXJscyxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUNvb2tpZSAoY29va2llTmFtZSwgdXJsKSB7XG4gICAgbG9nLmRlYnVnKGBEZWxldGluZyBjb29raWUgJyR7Y29va2llTmFtZX0nIG9uICcke3VybH0nYCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ1BhZ2UuZGVsZXRlQ29va2llJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgY29va2llTmFtZSxcbiAgICAgIHVybCxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdhcmJhZ2VDb2xsZWN0ICh0aW1lb3V0TXMgPSBHQVJCQUdFX0NPTExFQ1RfVElNRU9VVCkge1xuICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW5nIHdpdGggJHt0aW1lb3V0TXN9bXMgdGltZW91dGApO1xuICAgIGNvbnN0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBjb2xsZWN0IGdhcmJhZ2UgYXQgdGhpcyB0aW1lYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgQi5yZXNvbHZlKHRoaXMucnBjQ2xpZW50LnNlbmQoJ0hlYXAuZ2MnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSkpLnRpbWVvdXQodGltZW91dE1zKVxuICAgIC50aGVuKGZ1bmN0aW9uIGdjU3VjY2VzcyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpb24gc3VjY2Vzc2Z1bGApO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIGdjRXJyb3IgKGVycikgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW9uIHRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gY29sbGVjdCBnYXJiYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdXNlQXBwRGljdExvY2sgKGZuKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuX2xvY2suYWNxdWlyZSgnYXBwRGljdCcsIGZuKTtcbiAgfVxufVxuXG4vLyBldmVudCBlbWl0dGVkIHB1YmxpY2FsbHlcblJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFID0gJ3JlbW90ZV9kZWJ1Z2dlcl9wYWdlX2NoYW5nZSc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQgPSAncmVtb3RlX2RlYnVnZ2VyX2ZyYW1lc19kZXRhY2hlZCc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNUID0gJ3JlbW90ZV9kZWJ1Z2dlcl9kaXNjb25uZWN0JztcblxuLy8gYWRkIGdlbmVyaWMgY2FsbGJhY2tzXG5mb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiBfLnRvUGFpcnMobWVzc2FnZUhhbmRsZXJzKSkge1xuICBSZW1vdGVEZWJ1Z2dlci5wcm90b3R5cGVbbmFtZV0gPSBoYW5kbGVyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBSZW1vdGVEZWJ1Z2dlcjtcbmV4cG9ydCB7XG4gIFJlbW90ZURlYnVnZ2VyLCBSRU1PVEVfREVCVUdHRVJfUE9SVCwgUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMsXG59O1xuIl0sImZpbGUiOiJsaWIvcmVtb3RlLWRlYnVnZ2VyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
