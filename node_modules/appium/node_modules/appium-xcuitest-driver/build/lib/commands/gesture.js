"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

commands.mobileShake = async function mobileShake() {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  await this.opts.device.shake();
};

commands.click = async function click(el) {
  if (!this.isWebContext()) {
    return await this.nativeClick(el);
  }

  el = _appiumSupport.util.unwrapElement(el);

  if ((await this.settings.getSettings()).nativeWebTap) {
    _logger.default.debug('Using native web tap');

    await this.nativeWebTap(el);
  } else {
    const atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('click', [atomsElement]);
  }
};

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = async function performActions(actions) {
  _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

  const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
    parameters: {
      pointerType: 'touch'
    }
  } : {})).map(action => {
    const modifiedAction = _lodash.default.clone(action) || {};
    modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
    return modifiedAction;
  });

  _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

  return await this.proxyCommand('/actions', 'POST', {
    actions: preprocessedActions
  });
};

commands.performTouch = async function performTouch(gestures) {
  _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

  try {
    return await this.proxyCommand('/wda/touch/perform', 'POST', {
      actions: gestures
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.performMultiAction = async function performMultiAction(actions) {
  _logger.default.debug(`Received the following multi touch action:`);

  for (let i in actions) {
    _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
  }

  try {
    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {
      actions
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.nativeClick = async function nativeClick(el) {
  el = _appiumSupport.util.unwrapElement(el);
  let endpoint = `/element/${el}/click`;
  return await this.proxyCommand(endpoint, 'POST', {});
};

helpers.mobileScroll = async function mobileScroll(opts = {}, swipe = false) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  let params = {};

  if (opts.name && !swipe) {
    params.name = opts.name;
  } else if (opts.direction) {
    if (!['up', 'down', 'left', 'right'].includes(opts.direction.toLowerCase())) {
      let msg = 'Direction must be up, down, left or right';

      _logger.default.errorAndThrow(msg);
    }

    params.direction = opts.direction;
  } else if (opts.predicateString && !swipe) {
    params.predicateString = opts.predicateString;
  } else if (opts.toVisible && !swipe) {
    params.toVisible = opts.toVisible;
  } else {
    let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

    _logger.default.errorAndThrow(msg);
  }

  if (!swipe && opts.distance) {
    params.distance = opts.distance;
  }

  let element = _appiumSupport.util.unwrapElement(opts.element);

  let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
  return await this.proxyCommand(endpoint, 'POST', params);
};

helpers.mobileSwipe = async function mobileSwipe(opts = {}) {
  return await this.mobileScroll(opts, true);
};

function parseFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

helpers.mobilePinch = async function mobilePinch(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const params = {
    scale: parseFloatParameter('scale', opts.scale, 'pinch'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'pinch')
  };

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
};

helpers.mobileDoubleTap = async function mobileDoubleTap(opts = {}) {
  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
  }

  const params = {
    x: parseFloatParameter('x', opts.x, 'doubleTap'),
    y: parseFloatParameter('y', opts.y, 'doubleTap')
  };
  return await this.proxyCommand('/wda/doubleTap', 'POST', params);
};

helpers.mobileTwoFingerTap = async function mobileTwoFingerTap(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
};

helpers.mobileTouchAndHold = async function mobileTouchAndHold(opts = {}) {
  let params = {
    duration: parseFloatParameter('duration', opts.duration, 'touchAndHold')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
  }

  params.x = parseFloatParameter('x', opts.x, 'touchAndHold');
  params.y = parseFloatParameter('y', opts.y, 'touchAndHold');
  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);
};

helpers.mobileTap = async function mobileTap(opts = {}) {
  const params = {
    x: parseFloatParameter('x', opts.x, 'tap'),
    y: parseFloatParameter('y', opts.y, 'tap')
  };
  const el = opts.element ? _appiumSupport.util.unwrapElement(opts.element) : '0';
  return await this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
};

helpers.mobileDragFromToForDuration = async function mobileDragFromToForDuration(opts = {}) {
  const params = {
    duration: parseFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
    fromX: parseFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
    fromY: parseFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
    toX: parseFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
    toY: parseFloatParameter('toY', opts.toY, 'dragFromToForDuration')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
  }

  return await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
};

helpers.mobileSelectPickerWheelValue = async function mobileSelectPickerWheelValue(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
  }

  if (!_lodash.default.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {
    _logger.default.errorAndThrow(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    order: opts.order
  };

  if (opts.offset) {
    params.offset = parseFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
  }

  return await this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
};

helpers.mobileRotateElement = async function mobileRotateElement(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for rotateElement method');
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    rotation: parseFloatParameter('rotation', opts.rotation, 'rotateElement'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'rotateElement')
  };
  return await this.proxyCommand(`/wda/element/${el}/rotate`, 'POST', params);
};

helpers.getCoordinates = async function getCoordinates(gesture) {
  let el = gesture.options.element;
  let coordinates = {
    x: 0,
    y: 0,
    areOffsets: false
  };
  let optionX = null;

  if (gesture.options.x) {
    optionX = parseFloatParameter('x', gesture.options.x, 'getCoordinates');
  }

  let optionY = null;

  if (gesture.options.y) {
    optionY = parseFloatParameter('y', gesture.options.y, 'getCoordinates');
  }

  if (el) {
    let rect = await this.getElementRect(el);
    let pos = {
      x: rect.x,
      y: rect.y
    };
    let size = {
      w: rect.width,
      h: rect.height
    };
    let offsetX = 0;
    let offsetY = 0;

    if (optionX || optionY) {
      offsetX = optionX || 0;
      offsetY = optionY || 0;
    } else {
      offsetX = size.w / 2;
      offsetY = size.h / 2;
    }

    coordinates.x = pos.x + offsetX;
    coordinates.y = pos.y + offsetY;
  } else {
    coordinates.areOffsets = gesture.action === 'moveTo';
    coordinates.x = optionX || 0;
    coordinates.y = optionY || 0;
  }

  return coordinates;
};

helpers.applyMoveToOffset = function applyMoveToOffset(firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibG9nIiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJfIiwiZGlmZmVyZW5jZSIsImtleXMiLCJpc0FycmF5IiwiaW50ZXJzZWN0aW9uIiwibGVuZ3RoIiwiYWN0aW9uIiwieCIsImlzUGxhaW5PYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsInBlcmZvcm1BY3Rpb25zIiwiYWN0aW9ucyIsInByZXByb2Nlc3NlZEFjdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlIiwicGFyYW1ldGVycyIsInBvaW50ZXJUeXBlIiwibW9kaWZpZWRBY3Rpb24iLCJjbG9uZSIsImZpbHRlciIsImlubmVyQWN0aW9uIiwiZHVyYXRpb24iLCJwcm94eUNvbW1hbmQiLCJwZXJmb3JtVG91Y2giLCJlIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJpIiwicGFyc2VJbnQiLCJlbmRwb2ludCIsIm1vYmlsZVNjcm9sbCIsInN3aXBlIiwiZWxlbWVudCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsInBhcmFtcyIsIm5hbWUiLCJkaXJlY3Rpb24iLCJpbmNsdWRlcyIsInRvTG93ZXJDYXNlIiwibXNnIiwicHJlZGljYXRlU3RyaW5nIiwidG9WaXNpYmxlIiwiZGlzdGFuY2UiLCJtb2JpbGVTd2lwZSIsInBhcnNlRmxvYXRQYXJhbWV0ZXIiLCJwYXJhbU5hbWUiLCJwYXJhbVZhbHVlIiwibWV0aG9kTmFtZSIsImlzVW5kZWZpbmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsImlzTmFOIiwibW9iaWxlUGluY2giLCJzY2FsZSIsInZlbG9jaXR5IiwibW9iaWxlRG91YmxlVGFwIiwieSIsIm1vYmlsZVR3b0ZpbmdlclRhcCIsIm1vYmlsZVRvdWNoQW5kSG9sZCIsIm1vYmlsZVRhcCIsIm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiIsImZyb21YIiwiZnJvbVkiLCJ0b1giLCJ0b1kiLCJtb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlIiwiaXNTdHJpbmciLCJvcmRlciIsIm9mZnNldCIsIm1vYmlsZVJvdGF0ZUVsZW1lbnQiLCJyb3RhdGlvbiIsImdldENvb3JkaW5hdGVzIiwib3B0aW9ucyIsImNvb3JkaW5hdGVzIiwiYXJlT2Zmc2V0cyIsIm9wdGlvblgiLCJvcHRpb25ZIiwicmVjdCIsImdldEVsZW1lbnRSZWN0IiwicG9zIiwic2l6ZSIsInciLCJ3aWR0aCIsImgiLCJoZWlnaHQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImFwcGx5TW92ZVRvT2Zmc2V0IiwiZmlyc3RDb29yZGluYXRlcyIsInNlY29uZENvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxPQUFPLEdBQUcsRUFBZDtBQUFBLElBQWtCQyxVQUFVLEdBQUcsRUFBL0I7QUFBQSxJQUFtQ0MsUUFBUSxHQUFHLEVBQTlDOzs7O0FBRUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQkMsNkJBQVlDLE9BQVosQ0FBb0JGLE1BQXRDOztBQUVBRCxRQUFRLENBQUNJLFdBQVQsR0FB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aUIsQ0FBQ2pDO0FBRnJDLEtBQVA7QUFJRCxHQUxELE1BS087QUFDTCxXQUFPaUMsaUJBQVA7QUFDRDtBQUNGLENBVEQ7O0FBV0E5RSxNQUFNLENBQUNDLE1BQVAsQ0FBY2hELFVBQWQsRUFBMEJELE9BQTFCLEVBQW1DRSxRQUFuQztlQUVlRCxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBpb3NDb21tYW5kcyB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9LCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5tb3ZlVG8gPSBpb3NDb21tYW5kcy5nZXN0dXJlLm1vdmVUbztcblxuY29tbWFuZHMubW9iaWxlU2hha2UgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTaGFrZSAoKSB7XG4gIGlmICghdGhpcy5pc1NpbXVsYXRvcigpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1NoYWtlIGlzIG5vdCBzdXBwb3J0ZWQgb24gcmVhbCBkZXZpY2VzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5zaGFrZSgpO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiBjbGljayAoZWwpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gdGhlcmUgYXJlIG11bHRpcGxlIGNvbW1hbmRzIHRoYXQgbWFwIGhlcmUsIHNvIG1hbnVhbGx5IHByb3h5XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0aXZlQ2xpY2soZWwpO1xuICB9XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKChhd2FpdCB0aGlzLnNldHRpbmdzLmdldFNldHRpbmdzKCkpLm5hdGl2ZVdlYlRhcCkge1xuICAgIC8vIGF0b21zLWJhc2VkIGNsaWNrcyBkb24ndCBhbHdheXMgd29yayBpbiBzYWZhcmkgN1xuICAgIGxvZy5kZWJ1ZygnVXNpbmcgbmF0aXZlIHdlYiB0YXAnKTtcbiAgICBhd2FpdCB0aGlzLm5hdGl2ZVdlYlRhcChlbCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgfVxufTtcblxuZnVuY3Rpb24gZ2VzdHVyZXNDaGFpblRvU3RyaW5nIChnZXN0dXJlcywga2V5c1RvSW5jbHVkZSA9IFsnb3B0aW9ucyddKSB7XG4gIHJldHVybiBnZXN0dXJlcy5tYXAoKGl0ZW0pID0+IHtcbiAgICBsZXQgb3RoZXJLZXlzID0gXy5kaWZmZXJlbmNlKF8ua2V5cyhpdGVtKSwgWydhY3Rpb24nXSk7XG4gICAgb3RoZXJLZXlzID0gXy5pc0FycmF5KGtleXNUb0luY2x1ZGUpID8gXy5pbnRlcnNlY3Rpb24ob3RoZXJLZXlzLCBrZXlzVG9JbmNsdWRlKSA6IG90aGVyS2V5cztcbiAgICBpZiAob3RoZXJLZXlzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGAke2l0ZW0uYWN0aW9ufWAgK1xuICAgICAgICBgKCR7Xy5tYXAob3RoZXJLZXlzLCAoeCkgPT4geCArICc9JyArIChfLmlzUGxhaW5PYmplY3QoaXRlbVt4XSkgPyBKU09OLnN0cmluZ2lmeShpdGVtW3hdKSA6IGl0ZW1beF0pKS5qb2luKCcsICcpfSlgO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbS5hY3Rpb247XG4gIH0pLmpvaW4oJy0nKTtcbn1cblxuY29tbWFuZHMucGVyZm9ybUFjdGlvbnMgPSBhc3luYyBmdW5jdGlvbiBwZXJmb3JtQWN0aW9ucyAoYWN0aW9ucykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgVzNDIGFjdGlvbnM6ICR7SlNPTi5zdHJpbmdpZnkoYWN0aW9ucywgbnVsbCwgJyAgJyl9YCk7XG4gIC8vIFRoaXMgaXMgbWFuZGF0b3J5LCBzaW5jZSBXREEgb25seSBzdXBwb3J0cyBUT1VDSCBwb2ludGVyIHR5cGVcbiAgLy8gYW5kIFNlbGVuaXVtIEFQSSB1c2VzIE1PVVNFIGFzIHRoZSBkZWZhdWx0IG9uZVxuICBjb25zdCBwcmVwcm9jZXNzZWRBY3Rpb25zID0gYWN0aW9uc1xuICAgIC5tYXAoKGFjdGlvbikgPT4gT2JqZWN0LmFzc2lnbih7fSwgYWN0aW9uLCBhY3Rpb24udHlwZSA9PT0gJ3BvaW50ZXInID8ge1xuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICBwb2ludGVyVHlwZTogJ3RvdWNoJ1xuICAgICAgfVxuICAgIH0gOiB7fSkpXG4gICAgLm1hcCgoYWN0aW9uKSA9PiB7XG4gICAgICBjb25zdCBtb2RpZmllZEFjdGlvbiA9IF8uY2xvbmUoYWN0aW9uKSB8fCB7fTtcbiAgICAgIC8vIFNlbGVuaXVtIEFQSSB1bmV4cGVjdGVkbHkgaW5zZXJ0cyB6ZXJvIHBhdXNlcywgd2hpY2ggYXJlIG5vdCBzdXBwb3J0ZWQgYnkgV0RBXG4gICAgICBtb2RpZmllZEFjdGlvbi5hY3Rpb25zID0gKGFjdGlvbi5hY3Rpb25zIHx8IFtdKVxuICAgICAgICAuZmlsdGVyKChpbm5lckFjdGlvbikgPT4gIShpbm5lckFjdGlvbi50eXBlID09PSAncGF1c2UnICYmIGlubmVyQWN0aW9uLmR1cmF0aW9uID09PSAwKSk7XG4gICAgICByZXR1cm4gbW9kaWZpZWRBY3Rpb247XG4gICAgfSk7XG4gIGxvZy5kZWJ1ZyhgUHJlcHJvY2Vzc2VkIGFjdGlvbnM6ICR7SlNPTi5zdHJpbmdpZnkocHJlcHJvY2Vzc2VkQWN0aW9ucywgbnVsbCwgJyAgJyl9YCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL2FjdGlvbnMnLCAnUE9TVCcsIHthY3Rpb25zOiBwcmVwcm9jZXNzZWRBY3Rpb25zfSk7XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtVG91Y2ggPSBhc3luYyBmdW5jdGlvbiBwZXJmb3JtVG91Y2ggKGdlc3R1cmVzKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyB0b3VjaCBhY3Rpb246ICR7Z2VzdHVyZXNDaGFpblRvU3RyaW5nKGdlc3R1cmVzKX1gKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2gvcGVyZm9ybScsICdQT1NUJywge2FjdGlvbnM6IGdlc3R1cmVzfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KCdUaGUgVG91Y2ggQVBJIGlzIGFpbWVkIGZvciB1c2FnZSBpbiBOQVRJVkUgY29udGV4dC4gJyArXG4gICAgICAnQ29uc2lkZXIgdXNpbmcgXCJleGVjdXRlXCIgQVBJIHdpdGggY3VzdG9tIGV2ZW50cyB0cmlnZ2VyIHNjcmlwdCAnICtcbiAgICAgIGB0byBlbXVsYXRlIHRvdWNoIGV2ZW50cyBiZWluZyBpbiBXRUJWSUVXIGNvbnRleHQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGVyZm9ybU11bHRpQWN0aW9uID0gYXN5bmMgZnVuY3Rpb24gcGVyZm9ybU11bHRpQWN0aW9uIChhY3Rpb25zKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyBtdWx0aSB0b3VjaCBhY3Rpb246YCk7XG4gIGZvciAobGV0IGkgaW4gYWN0aW9ucykge1xuICAgIGxvZy5kZWJ1ZyhgICAgICR7cGFyc2VJbnQoaSwgMTApICsgMX06ICR7Xy5tYXAoYWN0aW9uc1tpXSwgJ2FjdGlvbicpLmpvaW4oJy0nKX1gKTtcbiAgfVxuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS90b3VjaC9tdWx0aS9wZXJmb3JtJywgJ1BPU1QnLCB7YWN0aW9uc30pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnVGhlIE11bHRpVG91Y2ggQVBJIGlzIGFpbWVkIGZvciB1c2FnZSBpbiBOQVRJVkUgY29udGV4dC4gJyArXG4gICAgICAnQ29uc2lkZXIgdXNpbmcgXCJleGVjdXRlXCIgQVBJIHdpdGggY3VzdG9tIGV2ZW50cyB0cmlnZ2VyIHNjcmlwdCAnICtcbiAgICAgIGB0byBlbXVsYXRlIG11bHRpdG91Y2ggZXZlbnRzIGJlaW5nIGluIFdFQlZJRVcgY29udGV4dC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5jb21tYW5kcy5uYXRpdmVDbGljayA9IGFzeW5jIGZ1bmN0aW9uIG5hdGl2ZUNsaWNrIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGxldCBlbmRwb2ludCA9IGAvZWxlbWVudC8ke2VsfS9jbGlja2A7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgJ1BPU1QnLCB7fSk7XG59O1xuXG4vKlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9XZWJEcml2ZXJBZ2VudC9ibG9iL21hc3Rlci9XZWJEcml2ZXJBZ2VudExpYi9Db21tYW5kcy9GQkVsZW1lbnRDb21tYW5kcy5tXG4gKiB0byBnZXQgdGhlIGluZm8gYWJvdXQgYXZhaWxhYmxlIFdEQSBnZXN0dXJlcyBBUElcbiAqXG4gKiBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL3JlZmVyZW5jZS94Y3Rlc3QveGN1aWVsZW1lbnQgYW5kXG4gKiBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vcmVmZXJlbmNlL3hjdGVzdC94Y3VpY29vcmRpbmF0ZSB0byBnZXQgdGhlIGRldGFpbGVkIGRlc2NyaXB0aW9uIG9mXG4gKiBhbGwgWENUZXN0IGdlc3R1cmVzXG4qL1xuXG5oZWxwZXJzLm1vYmlsZVNjcm9sbCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVNjcm9sbCAob3B0cyA9IHt9LCBzd2lwZSA9IGZhbHNlKSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgLy8gV0RBIHN1cHBvcnRzIGZvdXIgc2Nyb2xsaW5nIHN0cmF0ZWdpZXM6IHByZWRpY2F0aW9uIGJhc2VkIG9uIG5hbWUsIGRpcmVjdGlvbixcbiAgLy8gcHJlZGljYXRlU3RyaW5nLCBhbmQgdG9WaXNpYmxlLCBpbiB0aGF0IG9yZGVyLiBTd2lwaW5nIHJlcXVpcmVzIGRpcmVjdGlvbi5cbiAgbGV0IHBhcmFtcyA9IHt9O1xuICBpZiAob3B0cy5uYW1lICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy5uYW1lID0gb3B0cy5uYW1lO1xuICB9IGVsc2UgaWYgKG9wdHMuZGlyZWN0aW9uKSB7XG4gICAgaWYgKCFbJ3VwJywgJ2Rvd24nLCAnbGVmdCcsICdyaWdodCddLmluY2x1ZGVzKG9wdHMuZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICBsZXQgbXNnID0gJ0RpcmVjdGlvbiBtdXN0IGJlIHVwLCBkb3duLCBsZWZ0IG9yIHJpZ2h0JztcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgfVxuICAgIHBhcmFtcy5kaXJlY3Rpb24gPSBvcHRzLmRpcmVjdGlvbjtcbiAgfSBlbHNlIGlmIChvcHRzLnByZWRpY2F0ZVN0cmluZyAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMucHJlZGljYXRlU3RyaW5nID0gb3B0cy5wcmVkaWNhdGVTdHJpbmc7XG4gIH0gZWxzZSBpZiAob3B0cy50b1Zpc2libGUgJiYgIXN3aXBlKSB7XG4gICAgcGFyYW1zLnRvVmlzaWJsZSA9IG9wdHMudG9WaXNpYmxlO1xuICB9IGVsc2Uge1xuICAgIGxldCBtc2cgPSBzd2lwZVxuICAgICAgPyAnTW9iaWxlIHN3aXBlIHJlcXVpcmVzIGRpcmVjdGlvbidcbiAgICAgIDogJ01vYmlsZSBzY3JvbGwgc3VwcG9ydHMgdGhlIGZvbGxvd2luZyBzdHJhdGVnaWVzOiBuYW1lLCBkaXJlY3Rpb24sIHByZWRpY2F0ZVN0cmluZywgYW5kIHRvVmlzaWJsZS4gU3BlY2lmeSBvbmUgb2YgdGhlc2UnO1xuICAgIGxvZy5lcnJvckFuZFRocm93KG1zZyk7XG4gIH1cblxuICAvLyB3ZSBjYW4gYWxzbyBvcHRpb25hbGx5IHBhc3MgYSBkaXN0YW5jZSB3aGljaCBhcHBlYXJzIHRvIGJlIGEgcmF0aW8gb2ZcbiAgLy8gc2NyZWVuIGhlaWdodCwgc28gMS4wIG1lYW5zIGEgZnVsbCBzY3JlZW4ncyB3b3J0aCBvZiBzY3JvbGxpbmdcbiAgaWYgKCFzd2lwZSAmJiBvcHRzLmRpc3RhbmNlKSB7XG4gICAgcGFyYW1zLmRpc3RhbmNlID0gb3B0cy5kaXN0YW5jZTtcbiAgfVxuXG4gIGxldCBlbGVtZW50ID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIGxldCBlbmRwb2ludCA9IGAvd2RhL2VsZW1lbnQvJHtlbGVtZW50fS8ke3N3aXBlID8gJ3N3aXBlJyA6ICdzY3JvbGwnfWA7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTd2lwZSA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN3aXBlIChvcHRzID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMubW9iaWxlU2Nyb2xsKG9wdHMsIHRydWUpO1xufTtcblxuZnVuY3Rpb24gcGFyc2VGbG9hdFBhcmFtZXRlciAocGFyYW1OYW1lLCBwYXJhbVZhbHVlLCBtZXRob2ROYW1lKSB7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhcmFtVmFsdWUpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFwiJHtwYXJhbU5hbWV9XCIgcGFyYW1ldGVyIGlzIG1hbmRhdG9yeSBmb3IgXCIke21ldGhvZE5hbWV9XCIgY2FsbGApO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IHBhcnNlRmxvYXQocGFyYW1WYWx1ZSk7XG4gIGlmIChpc05hTihyZXN1bHQpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFwiJHtwYXJhbU5hbWV9XCIgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHZhbGlkIG51bWJlci4gXCIke3BhcmFtVmFsdWV9XCIgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmhlbHBlcnMubW9iaWxlUGluY2ggPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVQaW5jaCAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNjYWxlOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdzY2FsZScsIG9wdHMuc2NhbGUsICdwaW5jaCcpLFxuICAgIHZlbG9jaXR5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd2ZWxvY2l0eScsIG9wdHMudmVsb2NpdHksICdwaW5jaCcpXG4gIH07XG4gIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3BpbmNoYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVEb3VibGVUYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVEb3VibGVUYXAgKG9wdHMgPSB7fSkge1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gRG91YmxlIHRhcCBlbGVtZW50XG4gICAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9kb3VibGVUYXBgLCAnUE9TVCcpO1xuICB9XG4gIC8vIERvdWJsZSB0YXAgY29vcmRpbmF0ZXNcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICdkb3VibGVUYXAnKSxcbiAgICB5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAnZG91YmxlVGFwJylcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2RvdWJsZVRhcCcsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVHdvRmluZ2VyVGFwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlVHdvRmluZ2VyVGFwIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBvcHRzLmVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyhgY2xhc3MgbmFtZWAsIGBYQ1VJRWxlbWVudFR5cGVBcHBsaWNhdGlvbmAsIGZhbHNlKTtcbiAgfVxuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS90d29GaW5nZXJUYXBgLCAnUE9TVCcpO1xufTtcblxuaGVscGVycy5tb2JpbGVUb3VjaEFuZEhvbGQgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVUb3VjaEFuZEhvbGQgKG9wdHMgPSB7fSkge1xuICBsZXQgcGFyYW1zID0ge1xuICAgIGR1cmF0aW9uOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdkdXJhdGlvbicsIG9wdHMuZHVyYXRpb24sICd0b3VjaEFuZEhvbGQnKVxuICB9O1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gTG9uZyB0YXAgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vdG91Y2hBbmRIb2xkYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICB9XG4gIC8vIExvbmcgdGFwIGNvb3JkaW5hdGVzXG4gIHBhcmFtcy54ID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ3RvdWNoQW5kSG9sZCcpO1xuICBwYXJhbXMueSA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICd0b3VjaEFuZEhvbGQnKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoQW5kSG9sZCcsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVGFwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlVGFwIChvcHRzID0ge30pIHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICd0YXAnKSxcbiAgICB5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAndGFwJylcbiAgfTtcbiAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQgPyAodXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCkpIDogJzAnO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvdGFwLyR7ZWx9YCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24gPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2R1cmF0aW9uJywgb3B0cy5kdXJhdGlvbiwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIGZyb21YOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdmcm9tWCcsIG9wdHMuZnJvbVgsICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICBmcm9tWTogcGFyc2VGbG9hdFBhcmFtZXRlcignZnJvbVknLCBvcHRzLmZyb21ZLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9YOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd0b1gnLCBvcHRzLnRvWCwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIHRvWTogcGFyc2VGbG9hdFBhcmFtZXRlcigndG9ZJywgb3B0cy50b1ksICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKVxuICB9O1xuICBpZiAob3B0cy5lbGVtZW50KSB7XG4gICAgLy8gRHJhZyBlbGVtZW50XG4gICAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9kcmFnZnJvbXRvZm9yZHVyYXRpb25gLCAnUE9TVCcsIHBhcmFtcyk7XG4gIH1cbiAgLy8gRHJhZyBjb29yZGluYXRlc1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvZHJhZ2Zyb210b2ZvcmR1cmF0aW9uJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0VsZW1lbnQgaWQgaXMgZXhwZWN0ZWQgdG8gYmUgc2V0IGZvciBzZWxlY3RQaWNrZXJXaGVlbFZhbHVlIG1ldGhvZCcpO1xuICB9XG4gIGlmICghXy5pc1N0cmluZyhvcHRzLm9yZGVyKSB8fCAhWyduZXh0JywgJ3ByZXZpb3VzJ10uaW5jbHVkZXMob3B0cy5vcmRlci50b0xvd2VyQ2FzZSgpKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBUaGUgbWFuZGF0b3J5ICdvcmRlcicgcGFyYW1ldGVyIGlzIGV4cGVjdGVkIHRvIGJlIGVxdWFsIGVpdGhlciB0byAnbmV4dCcgb3IgJ3ByZXZpb3VzJy4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYCcke29wdHMub3JkZXJ9JyBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgY29uc3QgcGFyYW1zID0ge29yZGVyOiBvcHRzLm9yZGVyfTtcbiAgaWYgKG9wdHMub2Zmc2V0KSB7XG4gICAgcGFyYW1zLm9mZnNldCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ29mZnNldCcsIG9wdHMub2Zmc2V0LCAnc2VsZWN0UGlja2VyV2hlZWxWYWx1ZScpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9waWNrZXJ3aGVlbC8ke2VsfS9zZWxlY3RgLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVJvdGF0ZUVsZW1lbnQgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVSb3RhdGVFbGVtZW50IChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRWxlbWVudCBpZCBpcyBleHBlY3RlZCB0byBiZSBzZXQgZm9yIHJvdGF0ZUVsZW1lbnQgbWV0aG9kJyk7XG4gIH1cbiAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHJvdGF0aW9uOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdyb3RhdGlvbicsIG9wdHMucm90YXRpb24sICdyb3RhdGVFbGVtZW50JyksXG4gICAgdmVsb2NpdHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3ZlbG9jaXR5Jywgb3B0cy52ZWxvY2l0eSwgJ3JvdGF0ZUVsZW1lbnQnKSxcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vcm90YXRlYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5nZXRDb29yZGluYXRlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzIChnZXN0dXJlKSB7XG4gIGxldCBlbCA9IGdlc3R1cmUub3B0aW9ucy5lbGVtZW50O1xuXG4gIC8vIGRlZmF1bHRzXG4gIGxldCBjb29yZGluYXRlcyA9IHt4OiAwLCB5OiAwLCBhcmVPZmZzZXRzOiBmYWxzZX07XG5cbiAgbGV0IG9wdGlvblggPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLngpIHtcbiAgICBvcHRpb25YID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIGdlc3R1cmUub3B0aW9ucy54LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuICBsZXQgb3B0aW9uWSA9IG51bGw7XG4gIGlmIChnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgIG9wdGlvblkgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5JywgZ2VzdHVyZS5vcHRpb25zLnksICdnZXRDb29yZGluYXRlcycpO1xuICB9XG5cbiAgLy8gZmlndXJlIG91dCB0aGUgZWxlbWVudCBjb29yZGluYXRlcy5cbiAgaWYgKGVsKSB7XG4gICAgbGV0IHJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KGVsKTtcbiAgICBsZXQgcG9zID0ge3g6IHJlY3QueCwgeTogcmVjdC55fTtcbiAgICBsZXQgc2l6ZSA9IHt3OiByZWN0LndpZHRoLCBoOiByZWN0LmhlaWdodH07XG5cbiAgICAvLyBkZWZhdWx0c1xuICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICBsZXQgb2Zmc2V0WSA9IDA7XG5cbiAgICAvLyBnZXQgdGhlIHJlYWwgb2Zmc2V0c1xuICAgIGlmIChvcHRpb25YIHx8IG9wdGlvblkpIHtcbiAgICAgIG9mZnNldFggPSAob3B0aW9uWCB8fCAwKTtcbiAgICAgIG9mZnNldFkgPSAob3B0aW9uWSB8fCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2Zmc2V0WCA9IChzaXplLncgLyAyKTtcbiAgICAgIG9mZnNldFkgPSAoc2l6ZS5oIC8gMik7XG4gICAgfVxuXG4gICAgLy8gYXBwbHkgdGhlIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy54ID0gcG9zLnggKyBvZmZzZXRYO1xuICAgIGNvb3JkaW5hdGVzLnkgPSBwb3MueSArIG9mZnNldFk7XG4gIH0gZWxzZSB7XG4gICAgLy8gbW92ZVRvIGNvb3JkaW5hdGVzIGFyZSBwYXNzZWQgaW4gYXMgb2Zmc2V0c1xuICAgIGNvb3JkaW5hdGVzLmFyZU9mZnNldHMgPSAoZ2VzdHVyZS5hY3Rpb24gPT09ICdtb3ZlVG8nKTtcbiAgICBjb29yZGluYXRlcy54ID0gKG9wdGlvblggfHwgMCk7XG4gICAgY29vcmRpbmF0ZXMueSA9IChvcHRpb25ZIHx8IDApO1xuICB9XG4gIHJldHVybiBjb29yZGluYXRlcztcbn07XG5cbmhlbHBlcnMuYXBwbHlNb3ZlVG9PZmZzZXQgPSBmdW5jdGlvbiBhcHBseU1vdmVUb09mZnNldCAoZmlyc3RDb29yZGluYXRlcywgc2Vjb25kQ29vcmRpbmF0ZXMpIHtcbiAgaWYgKHNlY29uZENvb3JkaW5hdGVzLmFyZU9mZnNldHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogZmlyc3RDb29yZGluYXRlcy54ICsgc2Vjb25kQ29vcmRpbmF0ZXMueCxcbiAgICAgIHk6IGZpcnN0Q29vcmRpbmF0ZXMueSArIHNlY29uZENvb3JkaW5hdGVzLnksXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2Vjb25kQ29vcmRpbmF0ZXM7XG4gIH1cbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMpO1xuZXhwb3J0IHsgZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMsIGdlc3R1cmVzQ2hhaW5Ub1N0cmluZyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlc3R1cmUuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
