"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.detectUdid = detectUdid;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.getGenericSimulatorForIosVersion = getGenericSimulatorForIosVersion;
exports.checkAppPresent = checkAppPresent;
exports.getDriverInfo = getDriverInfo;
exports.clearSystemFiles = clearSystemFiles;
exports.translateDeviceName = translateDeviceName;
exports.normalizeCommandTimeouts = normalizeCommandTimeouts;
exports.markSystemFilesForCleanup = markSystemFilesForCleanup;
exports.printUser = printUser;
exports.getPIDsListeningOnPort = getPIDsListeningOnPort;
exports.encodeBase64OrUpload = encodeBase64OrUpload;
exports.removeAllSessionWebSocketHandlers = removeAllSessionWebSocketHandlers;
exports.verifyApplicationPlatform = verifyApplicationPlatform;
exports.isLocalHost = isLocalHost;
exports.normalizePlatformVersion = normalizePlatformVersion;
exports.DEFAULT_TIMEOUT_KEY = void 0;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumIosDevice = require("appium-ios-device");

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _appiumIosDriver = require("appium-ios-driver");

var _teen_process = require("teen_process");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _iosGenericSimulators = _interopRequireDefault(require("./ios-generic-simulators"));

var _fs2 = _interopRequireDefault(require("fs"));

var _url = _interopRequireDefault(require("url"));

var _os = _interopRequireDefault(require("os"));

var _v = _interopRequireDefault(require("v8"));

var _semver = _interopRequireDefault(require("semver"));

const DEFAULT_TIMEOUT_KEY = 'default';
exports.DEFAULT_TIMEOUT_KEY = DEFAULT_TIMEOUT_KEY;
const XCTEST_LOG_FILES_PATTERNS = [/^Session-WebDriverAgentRunner.*\.log$/i, /^StandardOutputAndStandardError\.txt$/i];
const XCTEST_LOGS_CACHE_FOLDER_PREFIX = 'com.apple.dt.XCTest';

async function detectUdid() {
  _logger.default.debug('Auto-detecting real device udid...');

  const udids = await _appiumIosDevice.utilities.getConnectedDevices();

  if (_lodash.default.isEmpty(udids)) {
    throw new Error('No device is connected to the host');
  }

  const udid = _lodash.default.last(udids);

  if (udids.length > 1) {
    _logger.default.warn(`Multiple devices found: ${udids.join(', ')}`);

    _logger.default.warn(`Choosing '${udid}'. If this is wrong, manually set with 'udid' desired capability`);
  }

  _logger.default.debug(`Detected real device udid: '${udid}'`);

  return udid;
}

async function getAndCheckXcodeVersion() {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.errorAndThrow(`Could not determine Xcode version: ${err.message}`);
  }

  if (version.versionFloat < 7.3) {
    _logger.default.errorAndThrow(`Xcode version '${version.versionString}'. Support for ` + `Xcode ${version.versionString} is not supported. ` + `Please upgrade to version 7.3 or higher`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  try {
    return await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.errorAndThrow(`Could not determine iOS SDK version: ${err.message}`);
  }
}

function getGenericSimulatorForIosVersion(platformVersion, deviceName) {
  let genericSimulators = _iosGenericSimulators.default[deviceName];

  if (genericSimulators) {
    genericSimulators = genericSimulators.sort(([simOne], [simTwo]) => _appiumSupport.util.compareVersions(simOne, '<', simTwo) ? -1 : 1);
    let genericIosSimulator;

    for (const [platformVersionFromList, iosSimulator] of genericSimulators) {
      if (_appiumSupport.util.compareVersions(platformVersionFromList, '>', platformVersion)) {
        break;
      }

      genericIosSimulator = iosSimulator;
    }

    return genericIosSimulator;
  }
}

function translateDeviceName(platformVersion, deviceName = '') {
  const deviceNameTranslated = getGenericSimulatorForIosVersion(platformVersion, deviceName.toLowerCase().trim());

  if (deviceNameTranslated) {
    _logger.default.debug(`Changing deviceName from '${deviceName}' to '${deviceNameTranslated}'`);

    return deviceNameTranslated;
  }

  return deviceName;
}

const derivedDataCleanupMarkers = new Map();

async function markSystemFilesForCleanup(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to mark system files for cleanup');

    return;
  }

  const logsRoot = _path.default.resolve((await wda.retrieveDerivedDataPath()), 'Logs');

  let markersCount = 0;

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    markersCount = derivedDataCleanupMarkers.get(logsRoot);
  }

  derivedDataCleanupMarkers.set(logsRoot, ++markersCount);
}

async function clearSystemFiles(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to clear system files');

    return;
  }

  const logsRoot = _path.default.resolve((await wda.retrieveDerivedDataPath()), 'Logs');

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    let markersCount = derivedDataCleanupMarkers.get(logsRoot);
    derivedDataCleanupMarkers.set(logsRoot, --markersCount);

    if (markersCount > 0) {
      _logger.default.info(`Not cleaning '${logsRoot}' folder, because the other session does not expect it to be cleaned`);

      return;
    }
  }

  derivedDataCleanupMarkers.set(logsRoot, 0);
  const globPattern = `${_os.default.tmpdir()}/${XCTEST_LOGS_CACHE_FOLDER_PREFIX}*/`;
  const dstFolders = await _appiumSupport.fs.glob(globPattern);

  if (_lodash.default.isEmpty(dstFolders)) {
    _logger.default.debug(`Did not find the temporary XCTest logs root at '${globPattern}'`);
  } else {
    for (const dstFolder of dstFolders) {
      let scheduledFilesCount = 0;

      _bluebird.default.resolve(_appiumSupport.fs.walkDir(dstFolder, true, (itemPath, isDir) => {
        if (isDir) {
          return;
        }

        const fileName = _path.default.basename(itemPath);

        if (!XCTEST_LOG_FILES_PATTERNS.some(p => p.test(fileName))) {
          return;
        }

        _appiumSupport.fs.unlink(itemPath).catch(e => {
          _logger.default.info(e.message);
        });

        scheduledFilesCount++;
      })).finally(() => {
        if (scheduledFilesCount > 0) {
          _logger.default.info(`Scheduled ${scheduledFilesCount} temporary XCTest log ` + `${_appiumSupport.util.pluralize('file', scheduledFilesCount)} for cleanup in '${dstFolder}'`);
        }
      }).catch(e => {
        _logger.default.info(e.message);
      });
    }

    _logger.default.debug(`Started background XCTest logs cleanup in '${dstFolders}'`);
  }

  if (await _appiumSupport.fs.exists(logsRoot)) {
    _logger.default.info(`Cleaning test logs in '${logsRoot}' folder`);

    await _appiumIosDriver.utils.clearLogs([logsRoot]);
    return;
  }

  _logger.default.info(`There is no ${logsRoot} folder, so not cleaning files`);
}

async function checkAppPresent(app) {
  _logger.default.debug(`Checking whether app '${app}' is actually present on file system`);

  if (!(await _appiumSupport.fs.exists(app))) {
    _logger.default.errorAndThrow(`Could not find app at '${app}'`);
  }

  _logger.default.debug('App is present');
}

async function getDriverInfo() {
  const stat = await _appiumSupport.fs.stat(_path.default.resolve(__dirname, '..'));
  const built = stat.mtime.getTime();

  const pkg = require(__filename.includes('build/lib/utils') ? '../../package.json' : '../package.json');

  const version = pkg.version;
  return {
    built,
    version
  };
}

function normalizeCommandTimeouts(value) {
  if (typeof value !== 'string') {
    return value;
  }

  let result = {};

  if (!isNaN(value)) {
    result[DEFAULT_TIMEOUT_KEY] = _lodash.default.toInteger(value);
    return result;
  }

  try {
    result = JSON.parse(value);

    if (!_lodash.default.isPlainObject(result)) {
      throw new Error();
    }
  } catch (err) {
    _logger.default.errorAndThrow(`"commandTimeouts" capability should be a valid JSON object. "${value}" was given instead`);
  }

  for (let [cmd, timeout] of _lodash.default.toPairs(result)) {
    if (!_lodash.default.isInteger(timeout) || timeout <= 0) {
      _logger.default.errorAndThrow(`The timeout for "${cmd}" should be a valid natural number of milliseconds. "${timeout}" was given instead`);
    }
  }

  return result;
}

async function printUser() {
  try {
    let {
      stdout
    } = await (0, _teen_process.exec)('whoami');

    _logger.default.debug(`Current user: '${stdout.trim()}'`);
  } catch (err) {
    _logger.default.debug(`Unable to get username running server: ${err.message}`);
  }
}

async function getPIDsListeningOnPort(port, filteringFunc = null) {
  const result = [];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('lsof', ['-ti', `tcp:${port}`]);
    result.push(...stdout.trim().split(/\n+/));
  } catch (e) {
    return result;
  }

  if (!_lodash.default.isFunction(filteringFunc)) {
    return result;
  }

  return await _bluebird.default.filter(result, async x => {
    const {
      stdout
    } = await (0, _teen_process.exec)('ps', ['-p', x, '-o', 'command']);
    return await filteringFunc(stdout);
  });
}

async function encodeBase64OrUpload(localFile, remotePath = null, uploadOptions = {}) {
  if (!(await _appiumSupport.fs.exists(localFile))) {
    _logger.default.errorAndThrow(`The file at '${localFile}' does not exist or is not accessible`);
  }

  const {
    size
  } = await _appiumSupport.fs.stat(localFile);

  _logger.default.debug(`The size of the file is ${_appiumSupport.util.toReadableSizeString(size)}`);

  if (_lodash.default.isEmpty(remotePath)) {
    const maxMemoryLimit = _v.default.getHeapStatistics().total_available_size / 2;

    if (size >= maxMemoryLimit) {
      _logger.default.info(`The file might be too large to fit into the process memory ` + `(${_appiumSupport.util.toReadableSizeString(size)} >= ${_appiumSupport.util.toReadableSizeString(maxMemoryLimit)}). ` + `Provide a link to a remote writable location for video upload ` + `(http(s) and ftp protocols are supported) if you experience Out Of Memory errors`);
    }

    const content = await _appiumSupport.fs.readFile(localFile);
    return content.toString('base64');
  }

  const remoteUrl = _url.default.parse(remotePath);

  let options = {};
  const {
    user,
    pass,
    method
  } = uploadOptions;

  if (remoteUrl.protocol.startsWith('http')) {
    options = {
      url: remoteUrl.href,
      method: method || 'PUT',
      multipart: [{
        body: _fs2.default.createReadStream(localFile)
      }]
    };

    if (user && pass) {
      options.auth = {
        user,
        pass
      };
    }
  } else if (remoteUrl.protocol === 'ftp:') {
    options = {
      host: remoteUrl.hostname,
      port: remoteUrl.port || 21
    };

    if (user && pass) {
      options.user = user;
      options.pass = pass;
    }
  }

  await _appiumSupport.net.uploadFile(localFile, remotePath, options);
  return '';
}

async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
}

async function verifyApplicationPlatform(app, expectedPlatform) {
  _logger.default.debug('Verifying application platform');

  const infoPlist = _path.default.resolve(app, 'Info.plist');

  if (!(await _appiumSupport.fs.exists(infoPlist))) {
    _logger.default.debug(`'${infoPlist}' does not exist`);

    return;
  }

  const {
    CFBundleSupportedPlatforms
  } = await _appiumSupport.plist.parsePlistFile(infoPlist);

  _logger.default.debug(`CFBundleSupportedPlatforms: ${JSON.stringify(CFBundleSupportedPlatforms)}`);

  if (!_lodash.default.isArray(CFBundleSupportedPlatforms)) {
    _logger.default.debug(`CFBundleSupportedPlatforms key does not exist in '${infoPlist}'`);

    return;
  }

  const {
    isSimulator,
    isTvOS
  } = expectedPlatform;
  const prefix = isTvOS ? 'AppleTV' : 'iPhone';
  const suffix = isSimulator ? 'Simulator' : 'OS';
  const dstPlatform = `${prefix}${suffix}`;

  if (!CFBundleSupportedPlatforms.includes(dstPlatform)) {
    throw new Error(`${isSimulator ? 'Simulator' : 'Real device'} architecture is unsupported by the '${app}' application. ` + `Make sure the correct deployment target has been selected for its compilation in Xcode.`);
  }
}

function isLocalHost(urlString) {
  try {
    const {
      hostname
    } = _url.default.parse(urlString);

    return ['localhost', '127.0.0.1', '::1', '::ffff:127.0.0.1'].includes(hostname);
  } catch (ign) {
    _logger.default.warn(`'${urlString}' cannot be parsed as a valid URL`);
  }

  return false;
}

function normalizePlatformVersion(originalVersion) {
  const normalizedVersion = _semver.default.coerce(originalVersion);

  if (!normalizedVersion) {
    throw new Error(`The platform version '${originalVersion}' should be a valid version number`);
  }

  return `${normalizedVersion.major}.${normalizedVersion.minor}`;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1RJTUVPVVRfS0VZIiwiWENURVNUX0xPR19GSUxFU19QQVRURVJOUyIsIlhDVEVTVF9MT0dTX0NBQ0hFX0ZPTERFUl9QUkVGSVgiLCJkZXRlY3RVZGlkIiwibG9nIiwiZGVidWciLCJ1ZGlkcyIsInV0aWxpdGllcyIsImdldENvbm5lY3RlZERldmljZXMiLCJfIiwiaXNFbXB0eSIsIkVycm9yIiwidWRpZCIsImxhc3QiLCJsZW5ndGgiLCJ3YXJuIiwiam9pbiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwidmVyc2lvbiIsInhjb2RlIiwiZ2V0VmVyc2lvbiIsImVyciIsImVycm9yQW5kVGhyb3ciLCJtZXNzYWdlIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsImdldE1heElPU1NESyIsImdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uIiwicGxhdGZvcm1WZXJzaW9uIiwiZGV2aWNlTmFtZSIsImdlbmVyaWNTaW11bGF0b3JzIiwiaW9zR2VuZXJpY1NpbXVsYXRvcnMiLCJzb3J0Iiwic2ltT25lIiwic2ltVHdvIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImdlbmVyaWNJb3NTaW11bGF0b3IiLCJwbGF0Zm9ybVZlcnNpb25Gcm9tTGlzdCIsImlvc1NpbXVsYXRvciIsInRyYW5zbGF0ZURldmljZU5hbWUiLCJkZXZpY2VOYW1lVHJhbnNsYXRlZCIsInRvTG93ZXJDYXNlIiwidHJpbSIsImRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMiLCJNYXAiLCJtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwIiwid2RhIiwicmV0cmlldmVEZXJpdmVkRGF0YVBhdGgiLCJsb2dzUm9vdCIsInBhdGgiLCJyZXNvbHZlIiwibWFya2Vyc0NvdW50IiwiaGFzIiwiZ2V0Iiwic2V0IiwiY2xlYXJTeXN0ZW1GaWxlcyIsImluZm8iLCJnbG9iUGF0dGVybiIsIm9zIiwidG1wZGlyIiwiZHN0Rm9sZGVycyIsImZzIiwiZ2xvYiIsImRzdEZvbGRlciIsInNjaGVkdWxlZEZpbGVzQ291bnQiLCJCIiwid2Fsa0RpciIsIml0ZW1QYXRoIiwiaXNEaXIiLCJmaWxlTmFtZSIsImJhc2VuYW1lIiwic29tZSIsInAiLCJ0ZXN0IiwidW5saW5rIiwiY2F0Y2giLCJlIiwiZmluYWxseSIsInBsdXJhbGl6ZSIsImV4aXN0cyIsImlvc1V0aWxzIiwiY2xlYXJMb2dzIiwiY2hlY2tBcHBQcmVzZW50IiwiYXBwIiwiZ2V0RHJpdmVySW5mbyIsInN0YXQiLCJfX2Rpcm5hbWUiLCJidWlsdCIsIm10aW1lIiwiZ2V0VGltZSIsInBrZyIsInJlcXVpcmUiLCJfX2ZpbGVuYW1lIiwiaW5jbHVkZXMiLCJub3JtYWxpemVDb21tYW5kVGltZW91dHMiLCJ2YWx1ZSIsInJlc3VsdCIsImlzTmFOIiwidG9JbnRlZ2VyIiwiSlNPTiIsInBhcnNlIiwiaXNQbGFpbk9iamVjdCIsImNtZCIsInRpbWVvdXQiLCJ0b1BhaXJzIiwiaXNJbnRlZ2VyIiwicHJpbnRVc2VyIiwic3Rkb3V0IiwiZ2V0UElEc0xpc3RlbmluZ09uUG9ydCIsInBvcnQiLCJmaWx0ZXJpbmdGdW5jIiwicHVzaCIsInNwbGl0IiwiaXNGdW5jdGlvbiIsImZpbHRlciIsIngiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCIsImxvY2FsRmlsZSIsInJlbW90ZVBhdGgiLCJ1cGxvYWRPcHRpb25zIiwic2l6ZSIsInRvUmVhZGFibGVTaXplU3RyaW5nIiwibWF4TWVtb3J5TGltaXQiLCJ2OCIsImdldEhlYXBTdGF0aXN0aWNzIiwidG90YWxfYXZhaWxhYmxlX3NpemUiLCJjb250ZW50IiwicmVhZEZpbGUiLCJ0b1N0cmluZyIsInJlbW90ZVVybCIsInVybCIsIm9wdGlvbnMiLCJ1c2VyIiwicGFzcyIsIm1ldGhvZCIsInByb3RvY29sIiwic3RhcnRzV2l0aCIsImhyZWYiLCJtdWx0aXBhcnQiLCJib2R5IiwiX2ZzIiwiY3JlYXRlUmVhZFN0cmVhbSIsImF1dGgiLCJob3N0IiwiaG9zdG5hbWUiLCJuZXQiLCJ1cGxvYWRGaWxlIiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic2Vzc2lvbklkIiwiZ2V0V2ViU29ja2V0SGFuZGxlcnMiLCJhY3RpdmVIYW5kbGVycyIsInBhdGhuYW1lIiwia2V5cyIsInJlbW92ZVdlYlNvY2tldEhhbmRsZXIiLCJ2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtIiwiZXhwZWN0ZWRQbGF0Zm9ybSIsImluZm9QbGlzdCIsIkNGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zIiwicGxpc3QiLCJwYXJzZVBsaXN0RmlsZSIsInN0cmluZ2lmeSIsImlzQXJyYXkiLCJpc1NpbXVsYXRvciIsImlzVHZPUyIsInByZWZpeCIsInN1ZmZpeCIsImRzdFBsYXRmb3JtIiwiaXNMb2NhbEhvc3QiLCJ1cmxTdHJpbmciLCJpZ24iLCJub3JtYWxpemVQbGF0Zm9ybVZlcnNpb24iLCJvcmlnaW5hbFZlcnNpb24iLCJub3JtYWxpemVkVmVyc2lvbiIsInNlbXZlciIsImNvZXJjZSIsIm1ham9yIiwibWlub3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxtQkFBbUIsR0FBRyxTQUE1Qjs7QUFDQSxNQUFNQyx5QkFBeUIsR0FBRyxDQUNoQyx3Q0FEZ0MsRUFFaEMsd0NBRmdDLENBQWxDO0FBSUEsTUFBTUMsK0JBQStCLEdBQUcscUJBQXhDOztBQUdBLGVBQWVDLFVBQWYsR0FBNkI7QUFDM0JDLGtCQUFJQyxLQUFKLENBQVUsb0NBQVY7O0FBQ0EsUUFBTUMsS0FBSyxHQUFHLE1BQU1DLDJCQUFVQyxtQkFBVixFQUFwQjs7QUFDQSxNQUFJQyxnQkFBRUMsT0FBRixDQUFVSixLQUFWLENB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QUFXLEdBQUksR0FBRUYsTUFBTyxHQUFFQyxNQUFPLEVBQXZDOztBQUNBLE1BQUksQ0FBQ1IsMEJBQTBCLENBQUNqRSxRQUEzQixDQUFvQzBFLFdBQXBDLENBQUwsRUFBdUQ7QUFDckQsVUFBTSxJQUFJOUosS0FBSixDQUFXLEdBQUUwSixXQUFXLEdBQUcsV0FBSCxHQUFpQixhQUFjLHdDQUF1Q2hGLEdBQUksaUJBQXhGLEdBQ2IseUZBREcsQ0FBTjtBQUVEO0FBQ0Y7O0FBT0QsU0FBU3FGLFdBQVQsQ0FBc0JDLFNBQXRCLEVBQWlDO0FBQy9CLE1BQUk7QUFDRixVQUFNO0FBQUN6QixNQUFBQTtBQUFELFFBQWFkLGFBQUk5QixLQUFKLENBQVVxRSxTQUFWLENBQW5COztBQUNBLFdBQU8sQ0FBQyxXQUFELEVBQWMsV0FBZCxFQUEyQixLQUEzQixFQUFrQyxrQkFBbEMsRUFBc0Q1RSxRQUF0RCxDQUErRG1ELFFBQS9ELENBQVA7QUFDRCxHQUhELENBR0UsT0FBTzBCLEdBQVAsRUFBWTtBQUNaeEssb0JBQUlXLElBQUosQ0FBVSxJQUFHNEosU0FBVSxtQ0FBdkI7QUFDRDs7QUFDRCxTQUFPLEtBQVA7QUFDRDs7QUFTRCxTQUFTRSx3QkFBVCxDQUFtQ0MsZUFBbkMsRUFBb0Q7QUFDbEQsUUFBTUMsaUJBQWlCLEdBQUdDLGdCQUFPQyxNQUFQLENBQWNILGVBQWQsQ0FBMUI7O0FBQ0EsTUFBSSxDQUFDQyxpQkFBTCxFQUF3QjtBQUN0QixVQUFNLElBQUlwSyxLQUFKLENBQVcseUJBQXdCbUssZUFBZ0Isb0NBQW5ELENBQU47QUFDRDs7QUFDRCxTQUFRLEdBQUVDLGlCQUFpQixDQUFDRyxLQUFNLElBQUdILGlCQUFpQixDQUFDSSxLQUFNLEVBQTdEO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyB1dGlsaXRpZXMgfSBmcm9tICdhcHBpdW0taW9zLWRldmljZSc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbmV0LCBwbGlzdCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgdXRpbHMgYXMgaW9zVXRpbHMgfSBmcm9tICdhcHBpdW0taW9zLWRyaXZlcic7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IGlvc0dlbmVyaWNTaW11bGF0b3JzIGZyb20gJy4vaW9zLWdlbmVyaWMtc2ltdWxhdG9ycyc7XG5pbXBvcnQgX2ZzIGZyb20gJ2ZzJztcbmltcG9ydCB1cmwgZnJvbSAndXJsJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgdjggZnJvbSAndjgnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuXG5jb25zdCBERUZBVUxUX1RJTUVPVVRfS0VZID0gJ2RlZmF1bHQnO1xuY29uc3QgWENURVNUX0xPR19GSUxFU19QQVRURVJOUyA9IFtcbiAgL15TZXNzaW9uLVdlYkRyaXZlckFnZW50UnVubmVyLipcXC5sb2ckL2ksXG4gIC9eU3RhbmRhcmRPdXRwdXRBbmRTdGFuZGFyZEVycm9yXFwudHh0JC9pLFxuXTtcbmNvbnN0IFhDVEVTVF9MT0dTX0NBQ0hFX0ZPTERFUl9QUkVGSVggPSAnY29tLmFwcGxlLmR0LlhDVGVzdCc7XG5cblxuYXN5bmMgZnVuY3Rpb24gZGV0ZWN0VWRpZCAoKSB7XG4gIGxvZy5kZWJ1ZygnQXV0by1kZXRlY3RpbmcgcmVhbCBkZXZpY2UgdWRpZC4uLicpO1xuICBjb25zdCB1ZGlkcyA9IGF3YWl0IHV0aWxpdGllcy5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gIGlmIChfLmlzRW1wdHkodWRpZHMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBkZXZpY2UgaXMgY29ubmVjdGVkIHRvIHRoZSBob3N0Jyk7XG4gIH1cbiAgY29uc3QgdWRpZCA9IF8ubGFzdCh1ZGlkcyk7XG4gIGlmICh1ZGlkcy5sZW5ndGggPiAxKSB7XG4gICAgbG9nLndhcm4oYE11bHRpcGxlIGRldmljZXMgZm91bmQ6ICR7dWRpZHMuam9pbignLCAnKX1gKTtcbiAgICBsb2cud2FybihgQ2hvb3NpbmcgJyR7dWRpZH0nLiBJZiB0aGlzIGlzIHdyb25nLCBtYW51YWxseSBzZXQgd2l0aCAndWRpZCcgZGVzaXJlZCBjYXBhYmlsaXR5YCk7XG4gIH1cbiAgbG9nLmRlYnVnKGBEZXRlY3RlZCByZWFsIGRldmljZSB1ZGlkOiAnJHt1ZGlkfSdgKTtcbiAgcmV0dXJuIHVkaWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uICgpIHtcbiAgbGV0IHZlcnNpb247XG4gIHRyeSB7XG4gICAgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24odHJ1ZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZGV0ZXJtaW5lIFhjb2RlIHZlcnNpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cblxuICAvLyB3ZSBkbyBub3Qgc3VwcG9ydCBYY29kZXMgPCA3LjMsXG4gIGlmICh2ZXJzaW9uLnZlcnNpb25GbG9hdCA8IDcuMykge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBYY29kZSB2ZXJzaW9uICcke3ZlcnNpb24udmVyc2lvblN0cmluZ30nLiBTdXBwb3J0IGZvciBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgWGNvZGUgJHt2ZXJzaW9uLnZlcnNpb25TdHJpbmd9IGlzIG5vdCBzdXBwb3J0ZWQuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBQbGVhc2UgdXBncmFkZSB0byB2ZXJzaW9uIDcuMyBvciBoaWdoZXJgKTtcbiAgfVxuICByZXR1cm4gdmVyc2lvbjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uICgpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZGV0ZXJtaW5lIGlPUyBTREsgdmVyc2lvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgZ2VuZXJpYyBzaW11bGF0b3IgZm9yIGEgZ2l2ZW4gSU9TIHZlcnNpb24gYW5kIGRldmljZSB0eXBlIChpUGhvbmUsIGlQYWQpXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwbGF0Zm9ybVZlcnNpb24gSU9TIHZlcnNpb24uIGUuZy4pIDEzLjBcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXZpY2VOYW1lIFR5cGUgb2YgSU9TIGRldmljZS4gQ2FuIGJlIGlQaG9uZSwgaVBhZCAocG9zc2libHkgbW9yZSBpbiB0aGUgZnV0dXJlKVxuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEdlbmVyaWMgaVBob25lIG9yIGlQYWQgc2ltdWxhdG9yIChpZiBhcHBsaWNhYmxlKVxuICovXG5mdW5jdGlvbiBnZXRHZW5lcmljU2ltdWxhdG9yRm9ySW9zVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uLCBkZXZpY2VOYW1lKSB7XG4gIGxldCBnZW5lcmljU2ltdWxhdG9ycyA9IGlvc0dlbmVyaWNTaW11bGF0b3JzW2RldmljZU5hbWVdO1xuXG4gIGlmIChnZW5lcmljU2ltdWxhdG9ycykge1xuICAgIGdlbmVyaWNTaW11bGF0b3JzID0gZ2VuZXJpY1NpbXVsYXRvcnMuc29ydCgoW3NpbU9uZV0sIFtzaW1Ud29dKSA9PiB1dGlsLmNvbXBhcmVWZXJzaW9ucyhzaW1PbmUsICc8Jywgc2ltVHdvKSA/IC0xIDogMSk7XG5cbiAgICAvLyBGaW5kIHRoZSBoaWdoZXN0IGlPUyB2ZXJzaW9uIGluIHRoZSBsaXN0IHRoYXQgaXMgYmVsb3cgdGhlIHByb3ZpZGVkIHZlcnNpb25cbiAgICBsZXQgZ2VuZXJpY0lvc1NpbXVsYXRvcjtcbiAgICBmb3IgKGNvbnN0IFtwbGF0Zm9ybVZlcnNpb25Gcm9tTGlzdCwgaW9zU2ltdWxhdG9yXSBvZiBnZW5lcmljU2ltdWxhdG9ycykge1xuICAgICAgaWYgKHV0aWwuY29tcGFyZVZlcnNpb25zKHBsYXRmb3JtVmVyc2lvbkZyb21MaXN0LCAnPicsIHBsYXRmb3JtVmVyc2lvbikpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBnZW5lcmljSW9zU2ltdWxhdG9yID0gaW9zU2ltdWxhdG9yO1xuICAgIH1cbiAgICByZXR1cm4gZ2VuZXJpY0lvc1NpbXVsYXRvcjtcbiAgfVxufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVEZXZpY2VOYW1lIChwbGF0Zm9ybVZlcnNpb24sIGRldmljZU5hbWUgPSAnJykge1xuICBjb25zdCBkZXZpY2VOYW1lVHJhbnNsYXRlZCA9IGdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uKHBsYXRmb3JtVmVyc2lvbiwgZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpLnRyaW0oKSk7XG4gIGlmIChkZXZpY2VOYW1lVHJhbnNsYXRlZCkge1xuICAgIGxvZy5kZWJ1ZyhgQ2hhbmdpbmcgZGV2aWNlTmFtZSBmcm9tICcke2RldmljZU5hbWV9JyB0byAnJHtkZXZpY2VOYW1lVHJhbnNsYXRlZH0nYCk7XG4gICAgcmV0dXJuIGRldmljZU5hbWVUcmFuc2xhdGVkO1xuICB9XG4gIHJldHVybiBkZXZpY2VOYW1lO1xufVxuXG4vLyBUaGlzIG1hcCBjb250YWlucyBkZXJpdmVkIGRhdGEgbG9ncyBmb2xkZXJzIGFzIGtleXNcbi8vIGFuZCB2YWx1ZXMgYXJlIHRoZSBjb3VudCBvZiB0aW1lcyB0aGUgcGFydGljdWxhclxuLy8gZm9sZGVyIGhhcyBiZWVuIHNjaGVkdWxlZCBmb3IgcmVtb3ZhbFxuY29uc3QgZGVyaXZlZERhdGFDbGVhbnVwTWFya2VycyA9IG5ldyBNYXAoKTtcblxuYXN5bmMgZnVuY3Rpb24gbWFya1N5c3RlbUZpbGVzRm9yQ2xlYW51cCAod2RhKSB7XG4gIGlmICghd2RhIHx8ICFhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSkge1xuICAgIGxvZy53YXJuKCdObyBXZWJEcml2ZXJBZ2VudCBkZXJpdmVkIGRhdGEgYXZhaWxhYmxlLCBzbyB1bmFibGUgdG8gbWFyayBzeXN0ZW0gZmlsZXMgZm9yIGNsZWFudXAnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsb2dzUm9vdCA9IHBhdGgucmVzb2x2ZShhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSwgJ0xvZ3MnKTtcbiAgbGV0IG1hcmtlcnNDb3VudCA9IDA7XG4gIGlmIChkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmhhcyhsb2dzUm9vdCkpIHtcbiAgICBtYXJrZXJzQ291bnQgPSBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmdldChsb2dzUm9vdCk7XG4gIH1cbiAgZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5zZXQobG9nc1Jvb3QsICsrbWFya2Vyc0NvdW50KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY2xlYXJTeXN0ZW1GaWxlcyAod2RhKSB7XG4gIC8vIG9ubHkgd2FudCB0byBjbGVhciB0aGUgc3lzdGVtIGZpbGVzIGZvciB0aGUgcGFydGljdWxhciBXREEgeGNvZGUgcnVuXG4gIGlmICghd2RhIHx8ICFhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSkge1xuICAgIGxvZy53YXJuKCdObyBXZWJEcml2ZXJBZ2VudCBkZXJpdmVkIGRhdGEgYXZhaWxhYmxlLCBzbyB1bmFibGUgdG8gY2xlYXIgc3lzdGVtIGZpbGVzJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nc1Jvb3QgPSBwYXRoLnJlc29sdmUoYXdhaXQgd2RhLnJldHJpZXZlRGVyaXZlZERhdGFQYXRoKCksICdMb2dzJyk7XG4gIGlmIChkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmhhcyhsb2dzUm9vdCkpIHtcbiAgICBsZXQgbWFya2Vyc0NvdW50ID0gZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5nZXQobG9nc1Jvb3QpO1xuICAgIGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuc2V0KGxvZ3NSb290LCAtLW1hcmtlcnNDb3VudCk7XG4gICAgaWYgKG1hcmtlcnNDb3VudCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKGBOb3QgY2xlYW5pbmcgJyR7bG9nc1Jvb3R9JyBmb2xkZXIsIGJlY2F1c2UgdGhlIG90aGVyIHNlc3Npb24gZG9lcyBub3QgZXhwZWN0IGl0IHRvIGJlIGNsZWFuZWRgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5zZXQobG9nc1Jvb3QsIDApO1xuXG4gIC8vIENsZWFuaW5nIHVwIGJpZyB0ZW1wb3JhcnkgZmlsZXMgY3JlYXRlZCBieSBYQ1Rlc3Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy85NDEwXG4gIGNvbnN0IGdsb2JQYXR0ZXJuID0gYCR7b3MudG1wZGlyKCl9LyR7WENURVNUX0xPR1NfQ0FDSEVfRk9MREVSX1BSRUZJWH0qL2A7XG4gIGNvbnN0IGRzdEZvbGRlcnMgPSBhd2FpdCBmcy5nbG9iKGdsb2JQYXR0ZXJuKTtcbiAgaWYgKF8uaXNFbXB0eShkc3RGb2xkZXJzKSkge1xuICAgIGxvZy5kZWJ1ZyhgRGlkIG5vdCBmaW5kIHRoZSB0ZW1wb3JhcnkgWENUZXN0IGxvZ3Mgcm9vdCBhdCAnJHtnbG9iUGF0dGVybn0nYCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gcGVyZm9ybSB0aGUgY2xlYW51cCBhc3luY2hyb25vdXNseVxuICAgIGZvciAoY29uc3QgZHN0Rm9sZGVyIG9mIGRzdEZvbGRlcnMpIHtcbiAgICAgIGxldCBzY2hlZHVsZWRGaWxlc0NvdW50ID0gMDtcbiAgICAgIEIucmVzb2x2ZShmcy53YWxrRGlyKGRzdEZvbGRlciwgdHJ1ZSwgKGl0ZW1QYXRoLCBpc0RpcikgPT4ge1xuICAgICAgICBpZiAoaXNEaXIpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBwYXRoLmJhc2VuYW1lKGl0ZW1QYXRoKTtcbiAgICAgICAgaWYgKCFYQ1RFU1RfTE9HX0ZJTEVTX1BBVFRFUk5TLnNvbWUoKHApID0+IHAudGVzdChmaWxlTmFtZSkpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGVsZXRlIHRoZSBmaWxlIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIGZzLnVubGluayhpdGVtUGF0aCkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICBsb2cuaW5mbyhlLm1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2NoZWR1bGVkRmlsZXNDb3VudCsrO1xuICAgICAgfSkpLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBpZiAoc2NoZWR1bGVkRmlsZXNDb3VudCA+IDApIHtcbiAgICAgICAgICBsb2cuaW5mbyhgU2NoZWR1bGVkICR7c2NoZWR1bGVkRmlsZXNDb3VudH0gdGVtcG9yYXJ5IFhDVGVzdCBsb2cgYCArXG4gICAgICAgICAgICBgJHt1dGlsLnBsdXJhbGl6ZSgnZmlsZScsIHNjaGVkdWxlZEZpbGVzQ291bnQpfSBmb3IgY2xlYW51cCBpbiAnJHtkc3RGb2xkZXJ9J2ApO1xuICAgICAgICB9XG4gICAgICB9KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBsb2cuaW5mbyhlLm1lc3NhZ2UpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgU3RhcnRlZCBiYWNrZ3JvdW5kIFhDVGVzdCBsb2dzIGNsZWFudXAgaW4gJyR7ZHN0Rm9sZGVyc30nYCk7XG4gIH1cblxuICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvZ3NSb290KSkge1xuICAgIGxvZy5pbmZvKGBDbGVhbmluZyB0ZXN0IGxvZ3MgaW4gJyR7bG9nc1Jvb3R9JyBmb2xkZXJgKTtcbiAgICBhd2FpdCBpb3NVdGlscy5jbGVhckxvZ3MoW2xvZ3NSb290XSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxvZy5pbmZvKGBUaGVyZSBpcyBubyAke2xvZ3NSb290fSBmb2xkZXIsIHNvIG5vdCBjbGVhbmluZyBmaWxlc2ApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjaGVja0FwcFByZXNlbnQgKGFwcCkge1xuICBsb2cuZGVidWcoYENoZWNraW5nIHdoZXRoZXIgYXBwICcke2FwcH0nIGlzIGFjdHVhbGx5IHByZXNlbnQgb24gZmlsZSBzeXN0ZW1gKTtcbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwcCkpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBmaW5kIGFwcCBhdCAnJHthcHB9J2ApO1xuICB9XG4gIGxvZy5kZWJ1ZygnQXBwIGlzIHByZXNlbnQnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RHJpdmVySW5mbyAoKSB7XG4gIGNvbnN0IHN0YXQgPSBhd2FpdCBmcy5zdGF0KHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicpKTtcbiAgY29uc3QgYnVpbHQgPSBzdGF0Lm10aW1lLmdldFRpbWUoKTtcblxuICAvLyBnZXQgdGhlIHBhY2thZ2UuanNvbiBhbmQgdGhlIHZlcnNpb24gZnJvbSBpdFxuICBjb25zdCBwa2cgPSByZXF1aXJlKF9fZmlsZW5hbWUuaW5jbHVkZXMoJ2J1aWxkL2xpYi91dGlscycpID8gJy4uLy4uL3BhY2thZ2UuanNvbicgOiAnLi4vcGFja2FnZS5qc29uJyk7XG4gIGNvbnN0IHZlcnNpb24gPSBwa2cudmVyc2lvbjtcblxuICByZXR1cm4ge1xuICAgIGJ1aWx0LFxuICAgIHZlcnNpb24sXG4gIH07XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUNvbW1hbmRUaW1lb3V0cyAodmFsdWUpIHtcbiAgLy8gVGhlIHZhbHVlIGlzIG5vcm1hbGl6ZWQgYWxyZWFkeVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGxldCByZXN1bHQgPSB7fTtcbiAgLy8gVXNlIGFzIGRlZmF1bHQgdGltZW91dCBmb3IgYWxsIGNvbW1hbmRzIGlmIGEgc2luZ2xlIGludGVnZXIgdmFsdWUgaXMgcHJvdmlkZWRcbiAgaWYgKCFpc05hTih2YWx1ZSkpIHtcbiAgICByZXN1bHRbREVGQVVMVF9USU1FT1VUX0tFWV0gPSBfLnRvSW50ZWdlcih2YWx1ZSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIEpTT04gb2JqZWN0IGhhcyBiZWVuIHByb3ZpZGVkLiBMZXQncyBwYXJzZSBpdFxuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgIGlmICghXy5pc1BsYWluT2JqZWN0KHJlc3VsdCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFwiY29tbWFuZFRpbWVvdXRzXCIgY2FwYWJpbGl0eSBzaG91bGQgYmUgYSB2YWxpZCBKU09OIG9iamVjdC4gXCIke3ZhbHVlfVwiIHdhcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgZm9yIChsZXQgW2NtZCwgdGltZW91dF0gb2YgXy50b1BhaXJzKHJlc3VsdCkpIHtcbiAgICBpZiAoIV8uaXNJbnRlZ2VyKHRpbWVvdXQpIHx8IHRpbWVvdXQgPD0gMCkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFRoZSB0aW1lb3V0IGZvciBcIiR7Y21kfVwiIHNob3VsZCBiZSBhIHZhbGlkIG5hdHVyYWwgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy4gXCIke3RpbWVvdXR9XCIgd2FzIGdpdmVuIGluc3RlYWRgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJpbnRVc2VyICgpIHtcbiAgdHJ5IHtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd3aG9hbWknKTtcbiAgICBsb2cuZGVidWcoYEN1cnJlbnQgdXNlcjogJyR7c3Rkb3V0LnRyaW0oKX0nYCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGdldCB1c2VybmFtZSBydW5uaW5nIHNlcnZlcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgSURzIG9mIHByb2Nlc3NlcyBsaXN0ZW5pbmcgb24gdGhlIHBhcnRpY3VsYXIgc3lzdGVtIHBvcnQuXG4gKiBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIGFwcGx5IGFkZGl0aW9uYWwgZmlsdGVyaW5nIGJhc2VkIG9uIHRoZVxuICogcHJvY2VzcyBjb21tYW5kIGxpbmUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwb3J0IC0gVGhlIHBvcnQgbnVtYmVyLlxuICogQHBhcmFtIHs/RnVuY3Rpb259IGZpbHRlcmluZ0Z1bmMgLSBPcHRpb25hbCBsYW1iZGEgZnVuY3Rpb24sIHdoaWNoXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVzIGNvbW1hbmQgbGluZSBzdHJpbmcgb2YgdGhlIHBhcnRpY3VsYXIgcHJvY2Vzc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5pbmcgb24gZ2l2ZW4gcG9ydCwgYW5kIGlzIGV4cGVjdGVkIHRvIHJldHVyblxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlaXRoZXIgdHJ1ZSBvciBmYWxzZSB0byBpbmNsdWRlL2V4Y2x1ZGUgdGhlIGNvcnJlc3BvbmRpbmcgUElEXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gdGhlIHJlc3VsdGluZyBhcnJheS5cbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSAtIHRoZSBsaXN0IG9mIG1hdGNoZWQgcHJvY2VzcyBpZHMuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFBJRHNMaXN0ZW5pbmdPblBvcnQgKHBvcnQsIGZpbHRlcmluZ0Z1bmMgPSBudWxsKSB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICB0cnkge1xuICAgIC8vIFRoaXMgb25seSB3b3JrcyBzaW5jZSBNYWMgT1MgWCBFbCBDYXBpdGFuXG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdsc29mJywgWyctdGknLCBgdGNwOiR7cG9ydH1gXSk7XG4gICAgcmVzdWx0LnB1c2goLi4uKHN0ZG91dC50cmltKCkuc3BsaXQoL1xcbisvKSkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmICghXy5pc0Z1bmN0aW9uKGZpbHRlcmluZ0Z1bmMpKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICByZXR1cm4gYXdhaXQgQi5maWx0ZXIocmVzdWx0LCBhc3luYyAoeCkgPT4ge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncHMnLCBbJy1wJywgeCwgJy1vJywgJ2NvbW1hbmQnXSk7XG4gICAgcmV0dXJuIGF3YWl0IGZpbHRlcmluZ0Z1bmMoc3Rkb3V0KTtcbiAgfSk7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVXBsb2FkT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdXNlciAtIFRoZSBuYW1lIG9mIHRoZSB1c2VyIGZvciB0aGUgcmVtb3RlIGF1dGhlbnRpY2F0aW9uLiBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcGFzcyAtIFRoZSBwYXNzd29yZCBmb3IgdGhlIHJlbW90ZSBhdXRoZW50aWNhdGlvbi4gT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IG1ldGhvZCAtIFRoZSBodHRwIG11bHRpcGFydCB1cGxvYWQgbWV0aG9kIG5hbWUuIFRoZSAnUFVUJyBvbmUgaXMgdXNlZCBieSBkZWZhdWx0LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqL1xuXG5cbi8qKlxuICogRW5jb2RlcyB0aGUgZ2l2ZW4gbG9jYWwgZmlsZSB0byBiYXNlNjQgYW5kIHJldHVybnMgdGhlIHJlc3VsdGluZyBzdHJpbmdcbiAqIG9yIHVwbG9hZHMgaXQgdG8gYSByZW1vdGUgc2VydmVyIHVzaW5nIGh0dHAvaHR0cHMgb3IgZnRwIHByb3RvY29sc1xuICogaWYgYHJlbW90ZVBhdGhgIGlzIHNldFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbEZpbGUgLSBUaGUgcGF0aCB0byBhbiBleGlzdGluZyBsb2NhbCBmaWxlXG4gKiBAcGFyYW0gez9zdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgcGF0aCB0byB0aGUgcmVtb3RlIGxvY2F0aW9uLCB3aGVyZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBmaWxlIHNob3VsZCBiZSB1cGxvYWRlZFxuICogQHBhcmFtIHs/VXBsb2FkT3B0aW9uc30gdXBsb2FkT3B0aW9ucyAtIFNldCBvZiB1cGxvYWQgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gRWl0aGVyIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgdXBsb2FkIHdhcyBzdWNjZXNzZnVsIG9yXG4gKiBiYXNlNjQtZW5jb2RlZCBmaWxlIHJlcHJlc2VudGF0aW9uIGlmIGByZW1vdGVQYXRoYCBpcyBmYWxzeVxuICovXG5hc3luYyBmdW5jdGlvbiBlbmNvZGVCYXNlNjRPclVwbG9hZCAobG9jYWxGaWxlLCByZW1vdGVQYXRoID0gbnVsbCwgdXBsb2FkT3B0aW9ucyA9IHt9KSB7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGZpbGUgYXQgJyR7bG9jYWxGaWxlfScgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuXG4gIGNvbnN0IHtzaXplfSA9IGF3YWl0IGZzLnN0YXQobG9jYWxGaWxlKTtcbiAgbG9nLmRlYnVnKGBUaGUgc2l6ZSBvZiB0aGUgZmlsZSBpcyAke3V0aWwudG9SZWFkYWJsZVNpemVTdHJpbmcoc2l6ZSl9YCk7XG4gIGlmIChfLmlzRW1wdHkocmVtb3RlUGF0aCkpIHtcbiAgICBjb25zdCBtYXhNZW1vcnlMaW1pdCA9IHY4LmdldEhlYXBTdGF0aXN0aWNzKCkudG90YWxfYXZhaWxhYmxlX3NpemUgLyAyO1xuICAgIGlmIChzaXplID49IG1heE1lbW9yeUxpbWl0KSB7XG4gICAgICBsb2cuaW5mbyhgVGhlIGZpbGUgbWlnaHQgYmUgdG9vIGxhcmdlIHRvIGZpdCBpbnRvIHRoZSBwcm9jZXNzIG1lbW9yeSBgICtcbiAgICAgICAgYCgke3V0aWwudG9SZWFkYWJsZVNpemVTdHJpbmcoc2l6ZSl9ID49ICR7dXRpbC50b1JlYWRhYmxlU2l6ZVN0cmluZyhtYXhNZW1vcnlMaW1pdCl9KS4gYCArXG4gICAgICAgIGBQcm92aWRlIGEgbGluayB0byBhIHJlbW90ZSB3cml0YWJsZSBsb2NhdGlvbiBmb3IgdmlkZW8gdXBsb2FkIGAgK1xuICAgICAgICBgKGh0dHAocykgYW5kIGZ0cCBwcm90b2NvbHMgYXJlIHN1cHBvcnRlZCkgaWYgeW91IGV4cGVyaWVuY2UgT3V0IE9mIE1lbW9yeSBlcnJvcnNgKTtcbiAgICB9XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnJlYWRGaWxlKGxvY2FsRmlsZSk7XG4gICAgcmV0dXJuIGNvbnRlbnQudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICB9XG5cbiAgY29uc3QgcmVtb3RlVXJsID0gdXJsLnBhcnNlKHJlbW90ZVBhdGgpO1xuICBsZXQgb3B0aW9ucyA9IHt9O1xuICBjb25zdCB7dXNlciwgcGFzcywgbWV0aG9kfSA9IHVwbG9hZE9wdGlvbnM7XG4gIGlmIChyZW1vdGVVcmwucHJvdG9jb2wuc3RhcnRzV2l0aCgnaHR0cCcpKSB7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHVybDogcmVtb3RlVXJsLmhyZWYsXG4gICAgICBtZXRob2Q6IG1ldGhvZCB8fCAnUFVUJyxcbiAgICAgIG11bHRpcGFydDogW3sgYm9keTogX2ZzLmNyZWF0ZVJlYWRTdHJlYW0obG9jYWxGaWxlKSB9XSxcbiAgICB9O1xuICAgIGlmICh1c2VyICYmIHBhc3MpIHtcbiAgICAgIG9wdGlvbnMuYXV0aCA9IHt1c2VyLCBwYXNzfTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVtb3RlVXJsLnByb3RvY29sID09PSAnZnRwOicpIHtcbiAgICBvcHRpb25zID0ge1xuICAgICAgaG9zdDogcmVtb3RlVXJsLmhvc3RuYW1lLFxuICAgICAgcG9ydDogcmVtb3RlVXJsLnBvcnQgfHwgMjEsXG4gICAgfTtcbiAgICBpZiAodXNlciAmJiBwYXNzKSB7XG4gICAgICBvcHRpb25zLnVzZXIgPSB1c2VyO1xuICAgICAgb3B0aW9ucy5wYXNzID0gcGFzcztcbiAgICB9XG4gIH1cbiAgYXdhaXQgbmV0LnVwbG9hZEZpbGUobG9jYWxGaWxlLCByZW1vdGVQYXRoLCBvcHRpb25zKTtcbiAgcmV0dXJuICcnO1xufVxuXG4vKipcbiAqIFN0b3BzIGFuZCByZW1vdmVzIGFsbCB3ZWIgc29ja2V0IGhhbmRsZXJzIHRoYXQgYXJlIGxpc3RlbmluZ1xuICogaW4gc2NvcGUgb2YgdGhlIGN1cnJlY3Qgc2Vzc2lvbi5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gc2VydmVyIC0gVGhlIGluc3RhbmNlIG9mIE5vZGVKcyBIVFRQIHNlcnZlcixcbiAqIHdoaWNoIGhvc3RzIEFwcGl1bVxuICogQHBhcmFtIHtzdHJpbmd9IHNlc3Npb25JZCAtIFRoZSBpZCBvZiB0aGUgY3VycmVudCBzZXNzaW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUGxhdGZvcm1PcHRzXG4gKlxuICogQHByb3BlcnR5IHtib29sZWFufSBpc1NpbXVsYXRvciAtIFdoZXRoZXIgdGhlIGRlc3RpbmF0aW9uIHBsYXRmb3JtIGlzIGEgU2ltdWxhdG9yXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzVHZPUyAtIFdoZXRoZXIgdGhlIGRlc3RpbmF0aW9uIHBsYXRmb3JtIGlzIGEgU2ltdWxhdG9yXG4gKi9cblxuLyoqXG4gKiBWZXJpZnkgd2hldGhlciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gaXMgY29tcGF0aWJsZSB0byB0aGVcbiAqIHBsYXRmb3JtIHdoZXJlIGl0IGlzIGdvaW5nIHRvIGJlIGluc3RhbGxlZCBhbmQgdGVzdGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHAgLSBUaGUgYWN0dWFsIHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uIGJ1bmRsZVxuICogQHBhcmFtIHtQbGF0Zm9ybU9wdHN9IGV4cGVjdGVkUGxhdGZvcm1cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBidW5kbGUgYXJjaGl0ZWN0dXJlIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBkZXZpY2UgYXJjaGl0ZWN0dXJlLlxuICovXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtIChhcHAsIGV4cGVjdGVkUGxhdGZvcm0pIHtcbiAgbG9nLmRlYnVnKCdWZXJpZnlpbmcgYXBwbGljYXRpb24gcGxhdGZvcm0nKTtcblxuICBjb25zdCBpbmZvUGxpc3QgPSBwYXRoLnJlc29sdmUoYXBwLCAnSW5mby5wbGlzdCcpO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhpbmZvUGxpc3QpKSB7XG4gICAgbG9nLmRlYnVnKGAnJHtpbmZvUGxpc3R9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHtDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3Jtc30gPSBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShpbmZvUGxpc3QpO1xuICBsb2cuZGVidWcoYENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zOiAke0pTT04uc3RyaW5naWZ5KENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zKX1gKTtcbiAgaWYgKCFfLmlzQXJyYXkoQ0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXMpKSB7XG4gICAgbG9nLmRlYnVnKGBDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3JtcyBrZXkgZG9lcyBub3QgZXhpc3QgaW4gJyR7aW5mb1BsaXN0fSdgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7XG4gICAgaXNTaW11bGF0b3IsXG4gICAgaXNUdk9TLFxuICB9ID0gZXhwZWN0ZWRQbGF0Zm9ybTtcbiAgY29uc3QgcHJlZml4ID0gaXNUdk9TID8gJ0FwcGxlVFYnIDogJ2lQaG9uZSc7XG4gIGNvbnN0IHN1ZmZpeCA9IGlzU2ltdWxhdG9yID8gJ1NpbXVsYXRvcicgOiAnT1MnO1xuICBjb25zdCBkc3RQbGF0Zm9ybSA9IGAke3ByZWZpeH0ke3N1ZmZpeH1gO1xuICBpZiAoIUNGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zLmluY2x1ZGVzKGRzdFBsYXRmb3JtKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtpc1NpbXVsYXRvciA/ICdTaW11bGF0b3InIDogJ1JlYWwgZGV2aWNlJ30gYXJjaGl0ZWN0dXJlIGlzIHVuc3VwcG9ydGVkIGJ5IHRoZSAnJHthcHB9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICBgTWFrZSBzdXJlIHRoZSBjb3JyZWN0IGRlcGxveW1lbnQgdGFyZ2V0IGhhcyBiZWVuIHNlbGVjdGVkIGZvciBpdHMgY29tcGlsYXRpb24gaW4gWGNvZGUuYCk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqIEBwYXJhbSB7P3N0cmluZ30gdXJsU3RyaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqL1xuZnVuY3Rpb24gaXNMb2NhbEhvc3QgKHVybFN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHtob3N0bmFtZX0gPSB1cmwucGFyc2UodXJsU3RyaW5nKTtcbiAgICByZXR1cm4gWydsb2NhbGhvc3QnLCAnMTI3LjAuMC4xJywgJzo6MScsICc6OmZmZmY6MTI3LjAuMC4xJ10uaW5jbHVkZXMoaG9zdG5hbWUpO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICBsb2cud2FybihgJyR7dXJsU3RyaW5nfScgY2Fubm90IGJlIHBhcnNlZCBhcyBhIHZhbGlkIFVSTGApO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBOb3JtYWxpemVzIHBsYXRmb3JtVmVyc2lvbiB0byBhIHZhbGlkIGlPUyB2ZXJzaW9uIHN0cmluZ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcmlnaW5hbFZlcnNpb24gLSBMb29zZSB2ZXJzaW9uIG51bWJlciwgdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHNlbXZlclxuICogQHJldHVybiB7c3RyaW5nfSBpT1MgdmVyc2lvbiBudW1iZXIgaW4gPG1ham9yPi48bWlub3I+IGZvcm1hdFxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSB2ZXJzaW9uIG51bWJlciBjYW5ub3QgYmUgcGFyc2VkXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiAob3JpZ2luYWxWZXJzaW9uKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRWZXJzaW9uID0gc2VtdmVyLmNvZXJjZShvcmlnaW5hbFZlcnNpb24pO1xuICBpZiAoIW5vcm1hbGl6ZWRWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGxhdGZvcm0gdmVyc2lvbiAnJHtvcmlnaW5hbFZlcnNpb259JyBzaG91bGQgYmUgYSB2YWxpZCB2ZXJzaW9uIG51bWJlcmApO1xuICB9XG4gIHJldHVybiBgJHtub3JtYWxpemVkVmVyc2lvbi5tYWpvcn0uJHtub3JtYWxpemVkVmVyc2lvbi5taW5vcn1gO1xufVxuXG5cbmV4cG9ydCB7IGRldGVjdFVkaWQsIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uLCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24sIGdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uLFxuICBjaGVja0FwcFByZXNlbnQsIGdldERyaXZlckluZm8sXG4gIGNsZWFyU3lzdGVtRmlsZXMsIHRyYW5zbGF0ZURldmljZU5hbWUsIG5vcm1hbGl6ZUNvbW1hbmRUaW1lb3V0cyxcbiAgREVGQVVMVF9USU1FT1VUX0tFWSwgbWFya1N5c3RlbUZpbGVzRm9yQ2xlYW51cCwgcHJpbnRVc2VyLFxuICBnZXRQSURzTGlzdGVuaW5nT25Qb3J0LCBlbmNvZGVCYXNlNjRPclVwbG9hZCwgcmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzLFxuICB2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtLCBpc0xvY2FsSG9zdCwgbm9ybWFsaXplUGxhdGZvcm1WZXJzaW9uIH07XG4iXSwiZmlsZSI6ImxpYi91dGlscy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
